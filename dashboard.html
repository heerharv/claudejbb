<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>UNCIA Jira Dashboard with Risk Management</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
<style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    background: linear-gradient(135deg, #552E8C 0%, #6B46C1 25%, #552E8C 50%, #7C3AED 75%, #552E8C 100%);
    min-height: 100vh;
    color: #333;
}

body::after {
    content: 'RV';
    position: fixed;
    bottom: 18px;
    right: 24px;
    font-size: 1.1rem;
    color: #7c3aed22;
    font-weight: 700;
    letter-spacing: 2px;
    pointer-events: none;
    z-index: 9999;
    user-select: none;
}

.header {
    background: rgba(85, 46, 140, 0.95);
    backdrop-filter: blur(20px);
    padding: 1rem 2rem;
    box-shadow: 0 8px 40px rgba(85, 46, 140, 0.4);
    border-bottom: 1px solid rgba(255,255,255,0.2);
    display: flex;
    align-items: center;
    gap: 1.5rem;
}

.header-logo {
    height: 60px;
    width: auto;
    flex-shrink: 0;
}

.header-content {
    flex: 1;
}

.header h1 {
    color: #ffffff;
    font-size: 2rem;
    font-weight: 700;
    text-shadow: 0 2px 10px rgba(0,0,0,0.3);
    margin: 0;
}

.header p {
    color: rgba(255,255,255,0.9);
    margin-top: 0.5rem;
}

.header-actions {
    display: flex;
    gap: 1rem;
    align-items: center;
}

.container {
    max-width: 95vw;
    margin: 0 auto;
    padding: 2rem;
    background: linear-gradient(135deg, #fafbff 0%, #f8fafc 100%);
    min-height: calc(100vh - 120px);
}

.controls {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    border-radius: 12px;
    padding: 1.5rem;
    margin-bottom: 2rem;
    box-shadow: 0 4px 20px rgba(0,0,0,0.1);
}

.project-selector {
    display: flex;
    align-items: center;
    gap: 1rem;
    flex-wrap: wrap;
}

.project-selector label {
    font-weight: 600;
    color: #2d3748;
}

.project-selector select {
    padding: 0.75rem 1rem;
    border: 2px solid #e2e8f0;
    border-radius: 8px;
    background: white;
    font-size: 1rem;
    min-width: 200px;
    cursor: pointer;
    transition: all 0.2s;
}

.project-selector select:focus {
    outline: none;
    border-color: #667eea;
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
}

.refresh-btn {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border: none;
    padding: 0.75rem 1.5rem;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
}

.refresh-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
}

.create-risk-btn {
    background: linear-gradient(135deg, #DC2626 0%, #EF4444 100%);
    color: white;
    border: none;
    padding: 0.75rem 1.5rem;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.create-risk-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(220, 38, 38, 0.3);
}

.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1.5rem;
    margin-bottom: 2rem;
}

.stat-card {
    background: #ffffff;
    border-radius: 16px;
    padding: 1.5rem;
    box-shadow: 0 4px 24px rgba(85, 46, 140, 0.18), 0 1.5px 6px rgba(0,0,0,0.08);
    border: 1px solid rgba(85, 46, 140, 0.1);
    transition: all 0.3s;
    position: relative;
}

.stat-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 4px;
    background: linear-gradient(90deg, #552E8C, #7C3AED);
}

.stat-card:hover {
    transform: translateY(-8px);
    box-shadow: 0 12px 40px rgba(85, 46, 140, 0.2);
    border-color: #552E8C;
}

.stat-card h3 {
    color: #552E8C;
    font-size: 0.9rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-bottom: 0.5rem;
    margin-top: 0.5rem;
}

.stat-card .value {
    font-size: 2.5rem;
    font-weight: 700;
    margin-bottom: 0.5rem;
    color: #552E8C;
}

.stat-card .label {
    color: #6b7280;
    font-size: 0.9rem;
}

.total .value { color: #60A5FA; }
.completed .value { color: #34D399; }
.progress .value { color: #FBBF24; }
.todo .value { color: #F87171; }
.risk-total .value { color: #F59E0B; }
.risk-critical .value { color: #EF4444; }
.risk-resolved .value { color: #10B981; }

/* Risk Management Section */
.risk-management-section {
    background: linear-gradient(135deg, #DC2626 0%, #EF4444 100%);
    border-radius: 16px;
    padding: 1.5rem;
    margin-bottom: 2rem;
    box-shadow: 0 4px 24px rgba(220, 38, 38, 0.18);
    border: 1px solid rgba(255,255,255,0.2);
}

.risk-management-section h2 {
    color: #ffffff;
    margin-bottom: 1.5rem;
    font-size: 1.5rem;
}

.risk-stats-row {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
    margin-bottom: 1.5rem;
}

.risk-stat-item {
    background: rgba(255,255,255,0.1);
    padding: 1rem;
    border-radius: 8px;
    text-align: center;
    backdrop-filter: blur(10px);
}

.risk-stat-value {
    font-size: 1.5rem;
    font-weight: bold;
    color: white;
}

.risk-stat-label {
    color: rgba(255,255,255,0.8);
    font-size: 0.9rem;
    margin-top: 0.25rem;
}

.risk-board {
    display: grid;
    grid-template-columns: repeat(5, 1fr);
    gap: 1rem;
    min-height: 400px;
}

.risk-column {
    background: rgba(255, 255, 255, 0.95);
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 4px 16px rgba(0,0,0,0.1);
}

.risk-column-header {
    padding: 1rem;
    font-weight: 600;
    color: white;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.identified-header { background: #F59E0B; }
.assessment-header { background: #EF4444; }
.mitigation-header { background: #8B5CF6; }
.monitoring-header { background: #06B6D4; }
.closed-header { background: #10B981; }

.risk-item {
    background: white;
    border: 1px solid #e2e8f0;
    border-radius: 8px;
    padding: 1rem;
    margin: 0.5rem;
    cursor: pointer;
    transition: all 0.2s;
}

.risk-item:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    border-color: #DC2626;
}

.risk-item-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0.5rem;
}

.risk-key {
    font-weight: 600;
    color: #DC2626;
    font-size: 0.8rem;
}

.risk-impact-badge {
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
    font-size: 0.7rem;
    font-weight: 600;
    text-transform: uppercase;
}

.impact-critical { background: #FEE2E2; color: #DC2626; }
.impact-high { background: #FED7AA; color: #EA580C; }
.impact-medium { background: #FEF3C7; color: #D97706; }
.impact-low { background: #D1FAE5; color: #059669; }

.risk-summary {
    font-size: 0.9rem;
    color: #374151;
    margin-bottom: 0.5rem;
    line-height: 1.4;
}

.risk-meta {
    display: flex;
    justify-content: space-between;
    font-size: 0.75rem;
    color: #6B7280;
}

.progress-section {
    background: #ffffff;
    border-radius: 16px;
    padding: 1.5rem;
    margin-bottom: 2rem;
    box-shadow: 0 4px 24px rgba(85, 46, 140, 0.18), 0 1.5px 6px rgba(0,0,0,0.08);
    border: 1px solid rgba(85, 46, 140, 0.1);
    position: relative;
}

.progress-section::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 4px;
    background: linear-gradient(90deg, #552E8C, #7C3AED);
}

.progress-section h2 {
    color: #552E8C;
    margin-bottom: 1rem;
    font-size: 1.5rem;
    margin-top: 0.5rem;
}

.progress-section p {
    color: #552E8C;
    font-weight: 600;
    font-size: 1.1rem;
}

.progress-bar-container {
    background: #f3f4f6;
    border-radius: 12px;
    height: 12px;
    overflow: hidden;
    margin-bottom: 1rem;
    border: 1px solid #e5e7eb;
}

.progress-bar {
    height: 100%;
    background: linear-gradient(90deg, #34D399 0%, #10B981 100%);
    border-radius: 12px;
    transition: width 1s ease-in-out;
}

/* Timeline Styles */
.timeline-section {
    background: #ffffff;
    border-radius: 16px;
    padding: 1.5rem;
    margin-bottom: 2rem;
    box-shadow: 0 4px 24px rgba(85, 46, 140, 0.18), 0 1.5px 6px rgba(0,0,0,0.08);
    border: 1px solid rgba(85, 46, 140, 0.1);
    position: relative;
}

.timeline-section::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 4px;
    background: linear-gradient(90deg, #552E8C, #7C3AED);
}

.timeline-section h2 {
    color: #552E8C;
    margin-bottom: 1.5rem;
    font-size: 1.5rem;
    margin-top: 0.5rem;
}

.timeline-container {
    display: flex;
    align-items: center;
    justify-content: space-between;
    position: relative;
    padding: 2rem 0;
    overflow-x: auto;
    min-width: 1000px;
}

.timeline-step {
    display: flex;
    flex-direction: column;
    align-items: center;
    min-width: 100px;
    z-index: 2;
    opacity: 0;
    transform: translateY(20px);
    transition: opacity 0.5s ease-out, transform 0.5s ease-out;
}

.step-number {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    font-size: 1.2rem;
    margin-bottom: 0.75rem;
    border: 3px solid #e2e8f0;
    background: white;
    color: #718096;
    transition: all 0.3s ease;
}

.timeline-step.completed .step-number {
    background: linear-gradient(135deg, #38a169 0%, #48bb78 100%);
    border-color: #38a169;
    color: white;
    position: relative;
}

.timeline-step.completed .step-number::after {
    content: '✓';
    font-size: 1rem;
    position: absolute;
}

.timeline-step.current .step-number {
    background: linear-gradient(135deg, #552E8C 0%, #7C3AED 100%);
    border-color: #552E8C;
    color: white;
    animation: pulse 2s infinite;
}

@keyframes pulse {
    0% { box-shadow: 0 0 0 0 rgba(85, 46, 140, 0.7); }
    70% { box-shadow: 0 0 0 10px rgba(85, 46, 140, 0); }
    100% { box-shadow: 0 0 0 0 rgba(85, 46, 140, 0); }
}

.step-content {
    text-align: center;
    max-width: 100px;
}

.step-content h4 {
    color: #552E8C;
    font-size: 0.85rem;
    font-weight: 600;
    margin-bottom: 0.25rem;
}

.step-content p {
    color: #6b7280;
    font-size: 0.7rem;
    line-height: 1.2;
}

.timeline-connector {
    height: 4px;
    background: #e5e7eb;
    flex: 1;
    margin: 0 10px;
    border-radius: 2px;
    position: relative;
    top: -40px;
    transform: scaleX(0);
    transform-origin: left;
    transition: transform 0.4s ease-out;
}

.timeline-connector.completed {
    background: linear-gradient(90deg, #34D399 0%, #10B981 100%);
}

.timeline-progress-text {
    text-align: center;
    margin-top: 1rem;
    color: #552E8C;
    font-weight: 600;
}

/* Calendar Styles */
.calendar-section {
    background: linear-gradient(90deg, #552E8C, #7C3AED);
    border-radius: 16px;
    padding: 1.5rem;
    margin: 2rem 0;
    box-shadow: 0 4px 24px rgba(85, 46, 140, 0.18), 0 1.5px 6px rgba(0,0,0,0.08);
    border: 1px solid rgba(85, 46, 140, 0.1);
    position: relative;
}

.calendar-section h2 {
    color: #ffffff;
    margin-bottom: 1.5rem;
    font-size: 1.5rem;
    margin-top: 0.5rem;
}

.calendar-container {
    display: grid;
    grid-template-columns: 1.5fr 1fr 1fr;
    gap: 1.5rem;
    align-items: stretch;
}

.calendar-widget-new {
    display: flex;
    gap: 1.5rem;
    background: white;
    border-radius: 16px;
    padding: 1.5rem;
    border: 1px solid #e2e8f0;
    box-shadow: 0 8px 25px rgba(0,0,0,0.15);
    line-height: 1;
    color: #552E8C;
    transition: all 0.3s ease;
}

.selected-date-display {
    flex: 0 0 140px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    color: #2d3748;
    border-right: 1px solid #eef2f7;
    padding-right: 1.5rem;
    text-align: center;
}

.selected-date-month {
    font-size: 1.75rem;
    font-weight: 700;
    line-height: 1.2;
}

.selected-date-weekday {
    font-size: 1.1rem;
    color: #718096;
    margin-bottom: 0.5rem;
}

.selected-date-number {
    font-size: 5.5rem;
    font-weight: 800;
    line-height: 1;
    color: #552E8C;
}

.mini-calendar {
    flex: 1;
    display: flex;
    flex-direction: column;
}

.calendar-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
    padding: 0 0.5rem;
}

.calendar-nav {
    background: none;
    border: none;
    color: #552E8C;
    font-size: 1.2rem;
    cursor: pointer;
    padding: 0.5rem;
    border-radius: 50%;
    transition: all 0.2s;
}

.calendar-nav:hover {
    background: rgba(85, 46, 140, 0.1);
}

.calendar-title {
    font-weight: 600;
    color: #2d3748;
    font-size: 1.1rem;
}

.calendar-weekdays {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 2px;
    margin-bottom: 0.5rem;
}

.calendar-weekday {
    text-align: center;
    font-weight: 700;
    color: #4a5568;
    font-size: 0.9rem;
    padding: 0.5rem 0;
}

@keyframes calendarDayPop {
    0% { transform: scale(1); }
    60% { transform: scale(1.2); }
    100% { transform: scale(1); }
}

@keyframes calendarGridFade {
    0% { opacity: 0; transform: translateY(20px); }
    100% { opacity: 1; transform: translateY(0); }
}

.calendar-grid {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 4px;
    animation: calendarGridFade 0.5s cubic-bezier(0.4,0,0.2,1);
}

.calendar-day {
    aspect-ratio: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    background: white;
    border-radius: 50%;
    cursor: pointer;
    transition: all 0.2s;
    position: relative;
    border: 2px solid transparent;
    font-size: 0.9rem;
}

.calendar-day:hover {
    background: #f7f3ff;
    border-color: #ddd6fe;
    transform: translateY(-2px);
    box-shadow: 0 4px 10px rgba(0,0,0,0.08);
}

.calendar-day.today {
    border-color: #552E8C;
    font-weight: 700;
}

.calendar-day.selected {
    background: #552E8C;
    color: white;
    font-weight: 700;
    border-color: #552E8C;
    animation: calendarDayPop 0.3s cubic-bezier(0.4,0,0.2,1);
}

.charts-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
    gap: 2rem;
    margin-bottom: 2rem;
}

.chart-card {
    background: rgba(85, 46, 140, 0.8);
    backdrop-filter: blur(20px);
    border-radius: 16px;
    padding: 1.5rem;
    box-shadow: 0 8px 32px rgba(85, 46, 140, 0.4);
    border: 1px solid rgba(255,255,255,0.2);
    height: 320px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
}

.chart-card h3 {
    color: #ffffff;
    margin-bottom: 1rem;
    font-size: 1.25rem;
}

/* Kanban Board Styles */
.board-section {
    background: rgba(85, 46, 140, 0.8);
    backdrop-filter: blur(20px);
    border-radius: 16px;
    padding: 1.5rem;
    margin-bottom: 2rem;
    box-shadow: 0 4px 24px rgba(85, 46, 140, 0.18), 0 1.5px 6px rgba(0,0,0,0.08);
    border: 1px solid rgba(255,255,255,0.2);
}

.board-section h2 {
    color: #fff;
    margin-bottom: 1.5rem;
    font-size: 1.5rem;
    margin-top: 0.5rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.board-toggle-btn {
    background: rgba(255,255,255,0.2);
    color: white;
    border: 1px solid rgba(255,255,255,0.3);
    padding: 0.5rem 1rem;
    border-radius: 6px;
    font-size: 0.9rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
}

.board-toggle-btn:hover {
    background: rgba(255,255,255,0.3);
    transform: translateY(-1px);
}

.kanban-board {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 1.5rem;
    min-height: 500px;
}

.kanban-column {
    background: rgba(255, 255, 255, 0.95);
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 4px 16px rgba(85, 46, 140, 0.10), 0 1px 3px rgba(0,0,0,0.06);
}

.column-header {
    padding: 1rem 1.5rem;
    font-weight: 600;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 1px solid rgba(0,0,0,0.1);
}

.todo-header {
    background: linear-gradient(135deg, #9370DB, #8A2BE2);
    color: white;
}

.progress-header {
    background: linear-gradient(135deg, #6B46C1, #552E8C);
    color: white;
}

.done-header {
    background: linear-gradient(135deg, #552E8C, #483D8B);
    color: white;
}

.column-header h3 {
    margin: 0;
    font-size: 1rem;
}

.issue-count {
    background: rgba(255,255,255,0.3);
    color: white;
    padding: 0.25rem 0.75rem;
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: 700;
}

.column-content {
    padding: 1rem;
    max-height: 450px;
    overflow-y: auto;
}

@keyframes boardCardFadeIn {
    from { opacity: 0; transform: translateY(16px); }
    to { opacity: 1; transform: translateY(0); }
}
.issue-card {
    background: white;
    border: 1px solid #e2e8f0;
    border-radius: 10px;
    padding: 1.1rem 1.2rem 1.1rem 1.2rem;
    margin-bottom: 1rem;
    box-shadow: 0 2px 8px rgba(85, 46, 140, 0.07);
    transition: box-shadow 0.2s, border-color 0.2s, transform 0.2s;
    opacity: 0;
    animation: boardCardFadeIn 0.5s cubic-bezier(0.4,0,0.2,1) forwards;
    cursor: pointer;
    position: relative;
    display: flex;
    flex-direction: column;
    gap: 0.3rem;
}
.issue-card:last-child { margin-bottom: 0; }
.issue-card:hover {
    border-color: #552E8C;
    box-shadow: 0 6px 18px rgba(85, 46, 140, 0.13);
    transform: translateY(-2px) scale(1.01);
}
.issue-key {
    font-size: 0.92rem;
    font-weight: 700;
    color: #552E8C;
    margin-bottom: 0.2rem;
    letter-spacing: 0.5px;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}
.issue-badge {
    display: inline-block;
    background: #ede9fe;
    color: #7c3aed;
    font-size: 0.7rem;
    font-weight: 600;
    border-radius: 6px;
    padding: 0.13em 0.7em;
    margin-left: 0.5em;
    letter-spacing: 0.5px;
}
.issue-summary {
    font-size: 1.05rem;
    color: #2d3748;
    margin-bottom: 0.5rem;
    line-height: 1.4;
    font-weight: 500;
}
.issue-meta {
    display: flex;
    flex-wrap: wrap;
    gap: 1.2rem;
    font-size: 0.85rem;
    color: #718096;
    align-items: center;
    border-top: 1px solid #f3f4f6;
    padding-top: 0.5rem;
    margin-top: 0.3rem;
}
.issue-assignee {
    background: #f3f4f6;
    color: #552E8C;
    padding: 0.18em 0.7em;
    border-radius: 5px;
    font-weight: 600;
    font-size: 0.85em;
}
.issue-type {
    background: #e0e7ff;
    color: #3730a3;
    border-radius: 5px;
    padding: 0.15em 0.7em;
    font-size: 0.8em;
    font-weight: 600;
    margin-left: 0.5em;
}
.issue-priority {
    margin-left: 0.5em;
}

.recent-activity {
    background: #f8fafc;
    border-radius: 12px;
    padding: 1.5rem;
    box-shadow: 0 8px 25px rgba(0,0,0,0.15);
    border: 1px solid #e2e8f0;
    max-height: 450px;
    overflow-y: auto;
}

.recent-activity h3 {
    color: #2d3748;
    margin-bottom: 1rem;
    font-size: 1.1rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

@keyframes activityFadeIn {
    from { opacity: 0; transform: translateY(16px); }
    to { opacity: 1; transform: translateY(0); }
}
.activity-item {
    display: flex;
    flex-direction: column;
    gap: 0.4rem;
    padding: 1rem 1.2rem 1rem 1.2rem;
    margin-bottom: 1rem;
    background: #fff;
    border-radius: 10px;
    border-left: 4px solid #8b5cf6;
    box-shadow: 0 2px 8px rgba(85, 46, 140, 0.07);
    opacity: 0;
    animation: activityFadeIn 0.5s cubic-bezier(0.4,0,0.2,1) forwards;
    cursor: pointer;
    transition: box-shadow 0.2s, border-color 0.2s, transform 0.2s;
    position: relative;
}
.activity-item:last-child { margin-bottom: 0; }
.activity-item:hover {
    border-color: #552E8C;
    box-shadow: 0 6px 18px rgba(85, 46, 140, 0.13);
    transform: translateY(-2px) scale(1.01);
}
.activity-header {
    display: flex;
    align-items: center;
    gap: 0.7rem;
    margin-bottom: 0.1rem;
}
.activity-key {
    font-weight: 700;
    color: #552E8C;
    font-size: 0.95rem;
    letter-spacing: 0.5px;
}
.activity-status-badge {
    display: inline-block;
    background: #ede9fe;
    color: #7c3aed;
    font-size: 0.7rem;
    font-weight: 600;
    border-radius: 6px;
    padding: 0.13em 0.7em;
    margin-left: 0.2em;
    letter-spacing: 0.5px;
}
.activity-summary {
    color: #2d3748;
    font-size: 1.02rem;
    font-weight: 500;
    line-height: 1.4;
    margin-bottom: 0.2rem;
}
.activity-meta {
    display: flex;
    flex-wrap: wrap;
    gap: 1.2rem;
    font-size: 0.85rem;
    color: #718096;
    align-items: center;
    border-top: 1px solid #f3f4f6;
    padding-top: 0.4rem;
    margin-top: 0.1rem;
}
.activity-assignee {
    background: #f3f4f6;
    color: #552E8C;
    padding: 0.18em 0.7em;
    border-radius: 5px;
    font-weight: 600;
    font-size: 0.85em;
}
.activity-type {
    background: #e0e7ff;
    color: #3730a3;
    border-radius: 5px;
    padding: 0.15em 0.7em;
    font-size: 0.8em;
    font-weight: 600;
    margin-left: 0.5em;
}

.risk-activity {
    border-left-color: #DC2626;
}

.risk-activity .activity-item {
    border-left-color: #DC2626;
}

.risk-activity .activity-item .activity-key {
    color: #DC2626;
}

.risk-activity .activity-item .activity-status-badge {
    background: #FEE2E2;
    color: #DC2626;
}

.risk-activity .activity-item .activity-summary {
    color: #DC2626;
}

.risk-activity .activity-item .activity-meta {
    color: #DC2626;
}

.risk-activity .activity-item .activity-assignee {
    background: #F3F4F6;
    color: #552E8C;
}

.risk-activity .activity-item .activity-type {
    background: #E0E7FF;
    color: #3730A3;
}

.insights {
    background: #dcd0ee;
    backdrop-filter: blur(10px);
    border-radius: 12px;
    padding: 1.5rem;
    margin-top: 2rem;
    box-shadow: 0 4px 24px rgba(85, 46, 140, 0.18), 0 1.5px 6px rgba(0,0,0,0.08);
}

.insights h2 {
    color: #2d3748;
    margin-bottom: 1rem;
    font-size: 1.5rem;
}

.insight-item {
    padding: 1rem;
    margin-bottom: 1rem;
    border-radius: 8px;
    border-left: 4px solid #38a169;
    box-shadow: 0 2px 12px rgba(85, 46, 140, 0.10), 0 1px 3px rgba(0,0,0,0.06);
}

.insight-warning { 
    background: #fef5e7; 
    border-left-color: #ed8936; 
}

.insight-success { 
    background: #f0fff4; 
    border-left-color: #38a169; 
}

.insight-info { 
    background: #ebf8ff; 
    border-left-color: #3182ce; 
}

.loading {
    text-align: center;
    padding: 3rem;
    color: #552E8C;
    font-size: 1.2rem;
}

.error, .success {
    padding: 1rem;
    border-radius: 12px;
    margin-bottom: 1rem;
    border: 1px solid rgba(255,255,255,0.3);
    backdrop-filter: blur(10px);
}

.error {
    background: rgba(248, 113, 113, 0.9);
    color: #ffffff;
}

.success {
    background: rgba(16, 185, 129, 0.9);
    color: #ffffff;
}

/* Risk Modal Styles */
.risk-modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.5);
    z-index: 1000;
    overflow-y: auto;
}

.risk-modal-content {
    background: white;
    margin: 2rem auto;
    padding: 2rem;
    border-radius: 12px;
    max-width: 600px;
    max-height: 90vh;
    overflow-y: auto;
    position: relative;
}

.risk-modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.5rem;
}

.risk-modal h2 {
    color: #DC2626;
    margin: 0;
}

.close-modal {
    background: none;
    border: none;
    font-size: 1.5rem;
    cursor: pointer;
    color: #6B7280;
    padding: 0.5rem;
    border-radius: 50%;
    transition: all 0.2s;
}

.close-modal:hover {
    background: #F3F4F6;
    color: #374151;
}

.form-group {
    margin-bottom: 1rem;
}

.form-label {
    display: block;
    font-weight: 600;
    margin-bottom: 0.5rem;
    color: #374151;
}

.form-input {
    width: 100%;
    padding: 0.75rem;
    border: 2px solid #e5e7eb;
    border-radius: 6px;
    font-size: 1rem;
    transition: border-color 0.2s;
}

.form-input:focus {
    outline: none;
    border-color: #DC2626;
}

.form-textarea {
    resize: vertical;
    min-height: 80px;
}

.form-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1rem;
}

.impact-levels {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 0.5rem;
}

.impact-level-option {
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    padding: 0.75rem;
    border: 2px solid #e5e7eb;
    border-radius: 6px;
    text-align: center;
    transition: all 0.2s;
}

.impact-level-option:hover {
    border-color: #DC2626;
    background: #FEE2E2;
}

.impact-level-option.selected {
    border-color: #DC2626;
    background: #FEE2E2;
    font-weight: bold;
}

.departments-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 0.5rem;
}

.dept-checkbox {
    display: flex;
    align-items: center;
    cursor: pointer;
}

.dept-checkbox input {
    margin-right: 0.5rem;
}

.form-actions {
    display: flex;
    gap: 1rem;
    justify-content: flex-end;
    margin-top: 1.5rem;
}

.btn {
    padding: 0.75rem 1.5rem;
    border-radius: 6px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
    border: none;
}

.btn-secondary {
    background: #F3F4F6;
    color: #374151;
    border: 2px solid #e5e7eb;
}

.btn-secondary:hover {
    background: #E5E7EB;
}

.btn-primary {
    background: linear-gradient(135deg, #DC2626 0%, #EF4444 100%);
    color: white;
}

.btn-primary:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(220, 38, 38, 0.3);
}

/* Responsive Design */
@media (max-width: 768px) {
    .container {
        padding: 1rem;
    }
    
    .header {
        padding: 1rem;
        flex-direction: column;
        text-align: center;
        gap: 1rem;
    }
    
    .header-actions {
        flex-direction: column;
        width: 100%;
    }
    
    .project-selector {
        flex-direction: column;
        align-items: stretch;
    }
    
    .charts-grid {
        grid-template-columns: 1fr;
    }
    
    .kanban-board, .risk-board {
        grid-template-columns: 1fr;
        gap: 1rem;
    }
    
    .calendar-container {
        grid-template-columns: 1fr;
        gap: 1rem;
    }
    
    .timeline-container {
        flex-direction: column;
        min-width: auto;
        gap: 1rem;
    }
    
    .timeline-connector {
        display: none;
    }
    
    .timeline-step {
        flex-direction: row;
        text-align: left;
        width: 100%;
        min-width: auto;
    }
    
    .risk-modal-content {
        margin: 1rem;
        padding: 1rem;
        max-height: 95vh;
    }
    
    .form-grid {
        grid-template-columns: 1fr;
    }
    
    .impact-levels {
        grid-template-columns: repeat(2, 1fr);
    }
    
    .risk-stats-row {
        grid-template-columns: repeat(2, 1fr);
        gap: 0.5rem;
    }
}

@keyframes taskFadeIn {
    from { opacity: 0; transform: translateY(16px); }
    to { opacity: 1; transform: translateY(0); }
}

.task-item {
    background: white;
    border-radius: 10px;
    padding: 1.1rem 1.2rem 1.1rem 1.2rem;
    border: 1px solid #e2e8f0;
    transition: box-shadow 0.2s, border-color 0.2s, transform 0.2s;
    box-shadow: 0 2px 8px rgba(85, 46, 140, 0.07);
    opacity: 0;
    animation: taskFadeIn 0.5s cubic-bezier(0.4,0,0.2,1) forwards;
    margin-bottom: 1rem;
    cursor: pointer;
    position: relative;
}
.task-item:last-child { margin-bottom: 0; }
.task-item:hover {
    border-color: #552E8C;
    box-shadow: 0 6px 18px rgba(85, 46, 140, 0.13);
    transform: translateY(-2px) scale(1.01);
}
.task-key {
    font-size: 0.92rem;
    font-weight: 700;
    color: #552E8C;
    margin-bottom: 0.2rem;
    letter-spacing: 0.5px;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}
.task-badge {
    display: inline-block;
    background: #ede9fe;
    color: #7c3aed;
    font-size: 0.7rem;
    font-weight: 600;
    border-radius: 6px;
    padding: 0.13em 0.7em;
    margin-left: 0.5em;
    letter-spacing: 0.5px;
}
.task-summary {
    font-size: 1.05rem;
    color: #2d3748;
    margin-bottom: 0.5rem;
    line-height: 1.4;
    font-weight: 500;
}
.task-meta {
    display: flex;
    flex-wrap: wrap;
    gap: 1.2rem;
    font-size: 0.85rem;
    color: #718096;
    align-items: center;
    border-top: 1px solid #f3f4f6;
    padding-top: 0.5rem;
    margin-top: 0.3rem;
}
.task-assignee {
    background: #f3f4f6;
    color: #552E8C;
    padding: 0.18em 0.7em;
    border-radius: 5px;
    font-weight: 600;
    font-size: 0.85em;
}
.task-start-date {
    color: #7c3aed;
    font-weight: 600;
}
.task-type {
    background: #e0e7ff;
    color: #3730a3;
    border-radius: 5px;
    padding: 0.15em 0.7em;
    font-size: 0.8em;
    font-weight: 600;
    margin-left: 0.5em;
}
.task-priority {
    margin-left: 0.5em;
}

@keyframes timelineStepFadeIn {
    from { opacity: 0; transform: translateY(30px) scale(0.95); }
    to { opacity: 1; transform: translateY(0) scale(1); }
}
@keyframes timelineConnectorDraw {
    from { opacity: 0; transform: scaleX(0); }
    to { opacity: 1; transform: scaleX(1); }
}
@keyframes timelineStepPop {
    0% { transform: scale(1); box-shadow: none; }
    60% { transform: scale(1.18); box-shadow: 0 0 0 8px #ede9fe; }
    100% { transform: scale(1); box-shadow: none; }
}

.timeline-section .timeline-step {
    opacity: 0;
    transform: translateY(30px) scale(0.95);
    animation: timelineStepFadeIn 0.6s cubic-bezier(0.4,0,0.2,1) forwards;
}
.timeline-section.in-view .timeline-step {
    opacity: 1;
    transform: translateY(0) scale(1);
}
.timeline-section.in-view .timeline-step:nth-of-type(1) { animation-delay: 0.1s; }
.timeline-section.in-view .timeline-step:nth-of-type(2) { animation-delay: 0.3s; }
.timeline-section.in-view .timeline-step:nth-of-type(3) { animation-delay: 0.5s; }
.timeline-section.in-view .timeline-step:nth-of-type(4) { animation-delay: 0.7s; }
.timeline-section.in-view .timeline-step:nth-of-type(5) { animation-delay: 0.9s; }
.timeline-section.in-view .timeline-step:nth-of-type(6) { animation-delay: 1.1s; }
.timeline-section.in-view .timeline-step:nth-of-type(7) { animation-delay: 1.3s; }
.timeline-section.in-view .timeline-step:nth-of-type(8) { animation-delay: 1.5s; }

.timeline-section .timeline-connector {
    opacity: 0;
    transform: scaleX(0);
    animation: timelineConnectorDraw 0.5s cubic-bezier(0.4,0,0.2,1) forwards;
}
.timeline-section.in-view .timeline-connector {
    opacity: 1;
    transform: scaleX(1);
}
.timeline-section.in-view .timeline-connector:nth-of-type(1) { animation-delay: 0.2s; }
.timeline-section.in-view .timeline-connector:nth-of-type(2) { animation-delay: 0.4s; }
.timeline-section.in-view .timeline-connector:nth-of-type(3) { animation-delay: 0.6s; }
.timeline-section.in-view .timeline-connector:nth-of-type(4) { animation-delay: 0.8s; }
.timeline-section.in-view .timeline-connector:nth-of-type(5) { animation-delay: 1.0s; }
.timeline-section.in-view .timeline-connector:nth-of-type(6) { animation-delay: 1.2s; }
.timeline-section.in-view .timeline-connector:nth-of-type(7) { animation-delay: 1.4s; }

.timeline-step.current .step-number {
    animation: timelineStepPop 0.5s cubic-bezier(0.4,0,0.2,1);
    box-shadow: 0 0 0 6px #ede9fe;
    border-color: #7c3aed;
}
.timeline-step.completed .step-number {
    transition: background 0.4s, border-color 0.4s;
    background: linear-gradient(135deg, #38a169 0%, #48bb78 100%);
    border-color: #38a169;
    color: white;
}

@keyframes timelineGlowPulse {
    0% { box-shadow: 0 0 0 0 #ede9fe, 0 0 0 0 #7c3aed; }
    50% { box-shadow: 0 0 0 12px #ede9fe, 0 0 0 24px #7c3aed33; }
    100% { box-shadow: 0 0 0 0 #ede9fe, 0 0 0 0 #7c3aed; }
}
@keyframes timelineTextFadeIn {
    from { opacity: 0; transform: translateY(16px); }
    to { opacity: 1; transform: translateY(0); }
}
@keyframes connectorSweep {
    0% { background: #e5e7eb; }
    100% { background: linear-gradient(90deg, #34D399 0%, #10B981 100%); }
}

.timeline-step .step-number {
    position: relative;
    z-index: 2;
}
.timeline-step.current .step-number {
    animation: timelineStepPop 0.5s cubic-bezier(0.4,0,0.2,1), timelineGlowPulse 2s infinite 0.5s;
    box-shadow: 0 0 0 6px #ede9fe;
    border-color: #7c3aed;
}
.timeline-step .step-content h4,
.timeline-step .step-content p {
    opacity: 0;
    animation: timelineTextFadeIn 0.5s cubic-bezier(0.4,0,0.2,1) forwards;
}
.timeline-section.in-view .timeline-step .step-content h4 {
    animation-delay: 0.3s;
    opacity: 1;
}
.timeline-section.in-view .timeline-step .step-content p {
    animation-delay: 0.5s;
    opacity: 1;
}
.timeline-section.in-view .timeline-connector.completed {
    animation: connectorSweep 0.8s cubic-bezier(0.4,0,0.2,1) forwards;
}

.daily-tasks {
    background: #f8fafc;
    border-radius: 12px;
    padding: 1.5rem;
    border: 1px solid #e2e8f0;
    max-height: 450px;
    overflow-y: auto;
    box-shadow: 0 8px 25px rgba(0,0,0,0.15);
    margin-bottom: 0;
    display: flex;
    flex-direction: column;
    justify-content: flex-start;
}

.calendar-task-dot {
  display: inline-block;
  width: 7px;
  height: 7px;
  background: #ff9800;
  border-radius: 50%;
  margin-left: 3px;
  vertical-align: middle;
  box-shadow: 0 0 2px #fff;
}
</style>
</head>
<body>
<div class="header">
    <img src="uncia_logo.png" alt="UNCIA Logo" style="height:40px; width:auto; display:block; margin-right:16px;"/>
    <div class="header-content">
        <h1>UNCIA Jira Dashboard with Risk Management</h1>
        <p>Integrated Project & Risk Management Dashboard</p>
    </div>
    <div class="header-actions">
        <button class="create-risk-btn" onclick="showCreateRiskModal()">
            🚨 Create Risk Report
        </button>
    </div>
</div>

<div class="container">
<div class="controls">
    <div class="project-selector">
        <label for="projectSelect">Select Project:</label>
        <select id="projectSelect">
            <option value="">Loading projects...</option>
        </select>
        <button class="refresh-btn" onclick="loadDataWithRisks()">🔄 Refresh</button>
    </div>
</div>

<div id="error-container"></div>
<div id="loading" class="loading">Loading integrated dashboard data...</div>
<div id="dashboard" style="display: none;">
    
    <!-- Enhanced Stats Grid with Risk Metrics -->
    <div class="stats-grid">
        <div class="stat-card total">
            <h3>Total Issues</h3>
            <div class="value" id="totalIssues">-</div>
            <div class="label">All issues in project</div>
        </div>
        <div class="stat-card completed">
            <h3>Completed</h3>
            <div class="value" id="completedIssues">-</div>
            <div class="label">Done & resolved</div>
        </div>
        <div class="stat-card progress">
            <h3>In Progress</h3>
            <div class="value" id="progressIssues">-</div>
            <div class="label">Currently active</div>
        </div>
        <div class="stat-card todo">
            <h3>To Do</h3>
            <div class="value" id="todoIssues">-</div>
            <div class="label">Pending work</div>
        </div>
        <div class="stat-card risk-total">
            <h3>Total Risks</h3>
            <div class="value" id="totalRisks">-</div>
            <div class="label">Active risk items</div>
        </div>
        <div class="stat-card risk-critical">
            <h3>Critical Risks</h3>
            <div class="value" id="criticalRisks">-</div>
            <div class="label">High priority risks</div>
        </div>
        <div class="stat-card risk-resolved">
            <h3>Risks Resolved</h3>
            <div class="value" id="resolvedRisks">-</div>
            <div class="label">This month</div>
        </div>
    </div>

    <!-- Risk Management Section -->
    <div class="risk-management-section">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
            <h2>🚨 Risk Management Dashboard</h2>
            <button class="create-risk-btn" onclick="showCreateRiskModal()">+ Create Risk Report</button>
        </div>
        
        <div class="risk-stats-row">
            <div class="risk-stat-item">
                <div class="risk-stat-value" id="riskTotalDisplay">0</div>
                <div class="risk-stat-label">Total Risks</div>
            </div>
            <div class="risk-stat-item">
                <div class="risk-stat-value" id="criticalRiskDisplay">0</div>
                <div class="risk-stat-label">Critical/High</div>
            </div>
            <div class="risk-stat-item">
                <div class="risk-stat-value" id="escalationDisplay">0</div>
                <div class="risk-stat-label">Need Escalation</div>
            </div>
            <div class="risk-stat-item">
                <div class="risk-stat-value" id="riskCoverageDisplay">0%</div>
                <div class="risk-stat-label">Risk Coverage</div>
            </div>
        </div>
        
        <div id="riskBoardContainer" style="display: none;">
            <!-- Risk board will be rendered here when toggled -->
        </div>
    </div>

    <!-- Enhanced Progress Section -->
    <div class="progress-section">
        <h2>📊 Project Progress (Risk Adjusted)</h2>
        <div class="progress-bar-container">
            <div class="progress-bar" id="progressBar" style="width: 0%"></div>
        </div>
        <p id="progressText">0% Complete</p>
    </div>

    <!-- Updated Project Timeline Section -->
    <div class="timeline-section">
        <h2>Project Implementation Timeline</h2>
        <div class="timeline-container">
            <div class="timeline-step completed" data-step="1">
                <div class="step-number">1</div>
                <div class="step-content">
                    <h4>Take Over</h4>
                    <p>Project handover & onboarding</p>
                </div>
            </div>
            <div class="timeline-connector completed"></div>
            
            <div class="timeline-step completed" data-step="2">
                <div class="step-number">2</div>
                <div class="step-content">
                    <h4>Day 0</h4>
                    <p>Initial setup & kickoff</p>
                </div>
            </div>
            <div class="timeline-connector completed"></div>
            
            <div class="timeline-step current" data-step="3">
                <div class="step-number">3</div>
                <div class="step-content">
                    <h4>GO LIVE INTIATION</h4>
                    <p>First deployment</p>
                </div>
            </div>
            <div class="timeline-connector"></div>
            
            <div class="timeline-step" data-step="4">
                <div class="step-number">4</div>
                <div class="step-content">
                    <h4>Readiness for Day !</h4>
                    <p>Preparation phase</p>
                </div>
            </div>
            <div class="timeline-connector"></div>
            
            <div class="timeline-step" data-step="5">
                <div class="step-number">5</div>
                <div class="step-content">
                    <h4>Solution Design</h4>
                    <p>Architecture & planning</p>
                </div>
            </div>
            <div class="timeline-connector"></div>
            
            <div class="timeline-step" data-step="6">
                <div class="step-number">6</div>
                <div class="step-content">
                    <h4>Reports</h4>
                    <p>Documentation & analysis</p>
                </div>
            </div>
            <div class="timeline-connector"></div>
            
            <div class="timeline-step" data-step="7">
                <div class="step-number">7</div>
                <div class="step-content">
                    <h4>Readiness for Go Live</h4>
                    <p>Final preparation</p>
                </div>
            </div>
            <div class="timeline-connector"></div>
            
            <div class="timeline-step" data-step="8">
                <div class="step-number">8</div>
                <div class="step-content">
                    <h4>GO LIVE</h4>
                    <p>Production launch</p>
                </div>
            </div>
        </div>
        <div class="timeline-progress-text">
            <span id="timelineProgressText">Step 3 of 8 - GO LIVE INTIATION Phase</span>
        </div>
    </div>

    <!-- Calendar Widget Section -->
    <div class="calendar-section">
        <h2>📅 Project Calendar</h2>
        <div class="calendar-container">
            <div class="calendar-widget-new">
                <div class="selected-date-display">
                    <div class="selected-date-month" id="selectedDateMonth"></div>
                    <div class="selected-date-weekday" id="selectedDateWeekday"></div>
                    <div class="selected-date-number" id="selectedDateNumber"></div>
                </div>
                <div class="mini-calendar">
                    <div class="calendar-header">
                        <button class="calendar-nav" id="prevMonth">‹</button>
                        <div class="calendar-title" id="calendarTitle"></div>
                        <button class="calendar-nav" id="nextMonth">›</button>
                    </div>
                    <div class="calendar-weekdays" id="calendarWeekdays"></div>
                    <div class="calendar-grid" id="calendarGrid"></div>
                </div>
            </div>
            <div class="daily-tasks">
                <h3 id="selectedDateTitle">📋 Today's Tasks</h3>
                <div class="tasks-list" id="dailyTasksList">
                    <div class="no-tasks">Select a date to view tasks</div>
                </div>
            </div>
            <div class="recent-activity">
                <h3>⚡ Recent Activity</h3>
                <div id="recentIssues"></div>
            </div>
        </div>
    </div>

    <!-- Enhanced Charts Grid -->
    <div class="charts-grid">
        <div class="chart-card">
            <h3>📈 Project vs Risk Status</h3>
            <canvas id="statusChart" width="400" height="200"></canvas>
        </div>
        <div class="chart-card">
            <h3>👥 Assignment Status</h3>
            <canvas id="assignmentChart" width="400" height="200"></canvas>
        </div>
        <div class="chart-card">
            <h3>🚨 Risk Distribution</h3>
            <canvas id="riskChart" width="400" height="200"></canvas>
        </div>
    </div>

    <!-- Enhanced Board Section -->
    <div class="board-section">
        <h2>📋 Project Board 
            <button id="board-toggle-btn" class="board-toggle-btn" onclick="toggleRiskBoard()">
                🚨 Show Risk Board
            </button>
        </h2>
        <div class="kanban-board" id="mainBoard">
            <div class="kanban-column">
                <div class="column-header todo-header">
                    <h3>📝 To Do</h3>
                    <span class="issue-count" id="todoCount">0</span>
                </div>
                <div class="column-content" id="todoColumn">
                    <div class="loading-board">Loading issues...</div>
                </div>
            </div>
            
            <div class="kanban-column">
                <div class="column-header progress-header">
                    <h3>🔄 In Progress</h3>
                    <span class="issue-count" id="progressCount">0</span>
                </div>
                <div class="column-content" id="progressColumn">
                    <div class="loading-board">Loading issues...</div>
                </div>
            </div>
            
            <div class="kanban-column">
                <div class="column-header done-header">
                    <h3>✅ Done</h3>
                    <span class="issue-count" id="doneCount">0</span>
                </div>
                <div class="column-content" id="doneColumn">
                    <div class="loading-board">Loading issues...</div>
                </div>
            </div>
        </div>
    </div>

    <div class="insights">
        <h2>💡 Project & Risk Insights</h2>
        <div id="projectInsights"></div>
    </div>
</div>
</div>

<!-- Risk Creation Modal -->
<div id="createRiskModal" class="risk-modal">
    <div class="risk-modal-content">
        <div class="risk-modal-header">
            <h2>🚨 Create Risk Report</h2>
            <button class="close-modal" onclick="closeRiskModal()">×</button>
        </div>
        
        <form id="riskForm" onsubmit="submitRiskForm(event)">
            <div class="form-group">
                <label class="form-label">📌 Risk Title *</label>
                <input type="text" id="riskTitle" class="form-input" required placeholder="Concise title summarizing the risk">
            </div>
            
            <div class="form-grid">
                <div class="form-group">
                    <label class="form-label">📍 Risk Category *</label>
                    <select id="riskCategory" class="form-input" required>
                        <option value="">Select Category</option>
                        <option value="Operational">Operational</option>
                        <option value="Financial">Financial</option>
                        <option value="Cybersecurity">Cybersecurity</option>
                        <option value="Technology">Technology & Integration</option>
                        <option value="Reputational">Reputational</option>
                        <option value="Compliance">Compliance & Regulatory</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">📄 Third-Party Involved *</label>
                    <input type="text" id="thirdParty" class="form-input" required placeholder="Vendor name & details">
                </div>
            </div>
            
            <div class="form-group">
                <label class="form-label">🎯 Risk Description *</label>
                <textarea id="riskDescription" class="form-input form-textarea" required placeholder="Briefly explain the risk, potential impact, and affected business areas"></textarea>
            </div>
            
            <div class="form-group">
                <label class="form-label">📉 Impact Level *</label>
                <div class="impact-levels">
                    <div class="impact-level-option" data-value="Low">
                        <span style="color: #059669;">Low</span>
                    </div>
                    <div class="impact-level-option" data-value="Medium">
                        <span style="color: #D97706;">Medium</span>
                    </div>
                    <div class="impact-level-option" data-value="High">
                        <span style="color: #EA580C;">High</span>
                    </div>
                    <div class="impact-level-option" data-value="Critical">
                        <span style="color: #DC2626;">Critical</span>
                    </div>
                </div>
            </div>
            
            <div class="form-group">
                <label class="form-label">👥 Departments Affected</label>
                <div class="departments-grid">
                    <label class="dept-checkbox">
                        <input type="checkbox" name="departments" value="IT"> IT
                    </label>
                    <label class="dept-checkbox">
                        <input type="checkbox" name="departments" value="Security"> Security
                    </label>
                    <label class="dept-checkbox">
                        <input type="checkbox" name="departments" value="Finance"> Finance
                    </label>
                    <label class="dept-checkbox">
                        <input type="checkbox" name="departments" value="Legal"> Legal
                    </label>
                    <label class="dept-checkbox">
                        <input type="checkbox" name="departments" value="Operations"> Operations
                    </label>
                    <label class="dept-checkbox">
                        <input type="checkbox" name="departments" value="Compliance"> Compliance
                    </label>
                </div>
            </div>
            
            <div class="form-group">
                <label class="dept-checkbox">
                    <input type="checkbox" id="escalationRequired">
                    <span class="form-label">📢 Escalation Required</span>
                </label>
            </div>
            
            <div class="form-group">
                <label class="form-label">⚠️ Recommended Action</label>
                <textarea id="recommendedAction" class="form-input form-textarea" placeholder="Suggested mitigation steps—without assuming responsibility for execution"></textarea>
            </div>
            
            <div class="form-actions">
                <button type="button" class="btn btn-secondary" onclick="closeRiskModal()">Cancel</button>
                <button type="submit" class="btn btn-primary">Create Risk Report</button>
            </div>
        </form>
    </div>
</div>

<script>
const API_BASE = 'http://localhost:8000';
let currentProject = 'SCRUM';
let dashboardData = null;
let riskData = null;
let integratedMetrics = null;
let allIssuesData = [];
let currentCalendarDate = new Date();
let selectedDate = new Date();
let showRiskBoard = false;

// Example: Dates with tasks (format: 'YYYY-MM-DD')
const taskDates = ["2025-06-03", "2025-06-23"];

// Load projects on page load
document.addEventListener('DOMContentLoaded', function() {
    loadProjects();
    initializeCalendar();
    setupIntersectionObserver();
    setupRiskModal();
});

async function loadProjects() {
    try {
        const response = await fetch(`${API_BASE}/api/jira-projects`);
        const data = await response.json();
        
        const select = document.getElementById('projectSelect');
        select.innerHTML = '';
        
        data.values.forEach(project => {
            const option = document.createElement('option');
            option.value = project.key;
            option.textContent = `${project.key} - ${project.name}`;
            select.appendChild(option);
        });
        
        // Set SCRUM as default
        select.value = 'SCRUM';
        currentProject = 'SCRUM';
        
        // Load initial data
        loadDataWithRisks();
        
        // Add change listener
        select.addEventListener('change', function() {
            currentProject = this.value;
            if (currentProject) {
                loadDataWithRisks();
            }
        });
        
    } catch (error) {
        showError('Failed to load projects: ' + error.message);
    }
}

async function loadDataWithRisks() {
    if (!currentProject) return;
    
    document.getElementById('loading').style.display = 'block';
    document.getElementById('dashboard').style.display = 'none';
    document.getElementById('error-container').innerHTML = '';
    
    try {
        // Load regular dashboard data first
        const response = await fetch(`${API_BASE}/api/jira/dashboard/${currentProject}`);
        if (!response.ok) {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }
        
        dashboardData = await response.json();
        
        // Try to load risk data (will use mock data if backend isn't updated yet)
        try {
            const riskResponse = await fetch(`${API_BASE}/api/risk/dashboard/${currentProject}`);
            if (riskResponse.ok) {
                const riskResponseData = await riskResponse.json();
                riskData = riskResponseData.risk_analytics || {};
                dashboardData.risk_integration = riskResponseData.risk_integration || {};
                dashboardData.total_risks = riskResponseData.total_risks || 0;
            } else {
                // Use mock risk data if backend endpoint doesn't exist yet
                riskData = generateMockRiskData();
                dashboardData.risk_integration = {
                    high_impact_risks: 3,
                    escalation_required: 2,
                    risk_to_project_ratio: 0.15
                };
                dashboardData.total_risks = 8;
            }
        } catch (error) {
            console.log('Risk endpoint not available, using mock data');
            riskData = generateMockRiskData();
            dashboardData.risk_integration = {
                high_impact_risks: 3,
                escalation_required: 2,
                risk_to_project_ratio: 0.15
            };
            dashboardData.total_risks = 8;
        }
        
        updateIntegratedDashboard();
        
        // Load calendar data
        await loadAllIssuesForCalendar();
        
    } catch (error) {
        showError('Failed to load dashboard data: ' + error.message);
    } finally {
        document.getElementById('loading').style.display = 'none';
    }
}

function generateMockRiskData() {
    return {
        by_category: {
            'Operational': 2,
            'Financial': 1,
            'Cybersecurity': 3,
            'Technology': 1,
            'Compliance': 1
        },
        by_impact: {
            'Critical': 1,
            'High': 2,
            'Medium': 3,
            'Low': 2
        },
        by_status: {
            'Open': 3,
            'In Progress': 2,
            'Under Review': 2,
            'Closed': 1
        },
        recent_risks: [
            {
                key: 'RISK-001',
                summary: 'Cloud Provider Service Outage Risk',
                status: 'Open',
                category: 'Operational',
                impact: 'High',
                created: new Date().toISOString()
            },
            {
                key: 'RISK-002',
                summary: 'Third-Party Data Processing Compliance',
                status: 'In Progress',
                category: 'Compliance',
                impact: 'Critical',
                created: new Date(Date.now() - 86400000).toISOString()
            }
        ],
        critical_risks: [
            {
                key: 'RISK-002',
                summary: 'Third-Party Data Processing Compliance',
                impact: 'Critical',
                status: 'In Progress'
            }
        ]
    };
}

function updateIntegratedDashboard() {
    if (!dashboardData) return;
    
    const { status_counts, progress_percentage, recent_issues, assignee_distribution } = dashboardData;
    const { risk_integration, total_risks } = dashboardData;
    
    // Update existing stats
    document.getElementById('totalIssues').textContent = status_counts.total || 0;
    document.getElementById('completedIssues').textContent = status_counts.done || 0;
    document.getElementById('progressIssues').textContent = status_counts.in_progress || 0;
    document.getElementById('todoIssues').textContent = status_counts.todo || 0;
    
    // Update NEW risk stats
    document.getElementById('totalRisks').textContent = total_risks || 0;
    document.getElementById('criticalRisks').textContent = risk_integration?.high_impact_risks || 0;
    document.getElementById('resolvedRisks').textContent = calculateResolvedRisksThisMonth();
    
    // Update risk management section stats
    document.getElementById('riskTotalDisplay').textContent = total_risks || 0;
    document.getElementById('criticalRiskDisplay').textContent = risk_integration?.high_impact_risks || 0;
    document.getElementById('escalationDisplay').textContent = risk_integration?.escalation_required || 0;
    document.getElementById('riskCoverageDisplay').textContent = Math.round((risk_integration?.risk_to_project_ratio || 0) * 100) + '%';
    
    // Update progress bar with risk consideration
    const riskAdjustedProgress = calculateRiskAdjustedProgress(progress_percentage);
    document.getElementById('progressBar').style.width = riskAdjustedProgress + '%';
    document.getElementById('progressText').textContent = `${riskAdjustedProgress}% Complete (Risk Adjusted)`;
    
    // Update charts
    updateIntegratedStatusChart(status_counts, riskData);
    updateRiskDistributionChart(riskData);
    updateAssignmentChart(assignee_distribution, status_counts.total);
    
    // Update recent activity with risk items
    updateIntegratedRecentActivity(recent_issues, riskData?.recent_risks);
    
    // Update insights with risk insights
    updateIntegratedInsights();
    
    // Update timeline with risk checkpoints
    updateRiskAwareTimeline();
    
    // Update board
    if (!showRiskBoard) {
        updateBoard();
    }
    
    document.getElementById('dashboard').style.display = 'block';
}

function calculateRiskAdjustedProgress(baseProgress) {
    if (!riskData || !dashboardData.risk_integration) return baseProgress;
    
    const highImpactRisks = dashboardData.risk_integration.high_impact_risks || 0;
    const riskPenalty = Math.min(20, highImpactRisks * 5); // Max 20% penalty
    
    return Math.max(0, Math.min(100, baseProgress - riskPenalty));
}

function updateIntegratedStatusChart(statusCounts, riskAnalytics) {
    const canvas = document.getElementById('statusChart');
    if (!canvas) return;
    
    const ctx = canvas.getContext('2d');
    
    if (window.statusChart && typeof window.statusChart.destroy === 'function') {
        window.statusChart.destroy();
    }
    
    // Enhanced data including risk overlay
    const projectData = [
        statusCounts.todo || 0,
        statusCounts.in_progress || 0,
        statusCounts.done || 0
    ];
    
    const riskStatusData = [
        (riskAnalytics?.by_status?.["Open"] || 0) + (riskAnalytics?.by_status?.["To Do"] || 0),
        riskAnalytics?.by_status?.["In Progress"] || 0,
        (riskAnalytics?.by_status?.["Closed"] || 0) + (riskAnalytics?.by_status?.["Done"] || 0)
    ];
    
    window.statusChart = new Chart(ctx, {
        type: 'doughnut',
        data: {
            labels: ['To Do', 'In Progress', 'Done'],
            datasets: [{
                label: 'Project Tasks',
                data: projectData,
                backgroundColor: ['#F87171', '#FBBF24', '#34D399'],
                borderWidth: 3,
                borderColor: '#ffffff'
            }, {
                label: 'Risk Items',
                data: riskStatusData,
                backgroundColor: ['#FCA5A5', '#FCD34D', '#6EE7B7'],
                borderWidth: 2,
                borderColor: '#ffffff'
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'bottom',
                    labels: { color: '#374151', padding: 20 }
                },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            const datasetLabel = context.dataset.label;
                            const value = context.parsed;
                            return `${datasetLabel} - ${context.label}: ${value}`;
                        }
                    }
                }
            }
        }
    });
}

function updateRiskDistributionChart(riskAnalytics) {
    const canvas = document.getElementById('riskChart');
    if (!canvas || !riskAnalytics?.by_category) return;
    
    const ctx = canvas.getContext('2d');
    
    if (window.riskChart && typeof window.riskChart.destroy === 'function') {
        window.riskChart.destroy();
    }
    
    const categories = Object.keys(riskAnalytics.by_category);
    const values = Object.values(riskAnalytics.by_category);
    
    if (categories.length === 0) {
        ctx.fillStyle = '#6b7280';
        ctx.font = '16px Arial';
        ctx.textAlign = 'center';
        ctx.fillText('No risk data available', canvas.width / 2, canvas.height / 2);
        return;
    }
    
    window.riskChart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: categories,
            datasets: [{
                label: 'Risk Count',
                data: values,
                backgroundColor: [
                    '#EF4444', '#F59E0B', '#8B5CF6', 
                    '#06B6D4', '#10B981', '#F97316'
                ],
                borderRadius: 8,
                borderWidth: 0
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { display: false },
                title: {
                    display: false
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: { color: '#6B7280' }
                },
                x: {
                    ticks: { 
                        color: '#6B7280',
                        maxRotation: 45
                    }
                }
            }
        }
    });
}

function updateAssignmentChart(assigneeDistribution, totalIssues) {
    const canvas = document.getElementById('assignmentChart');
    if (!canvas) return;
    
    const ctx = canvas.getContext('2d');
    
    if (window.assignmentChart && typeof window.assignmentChart.destroy === 'function') {
        window.assignmentChart.destroy();
    }
    
    const assignedCount = Object.values(assigneeDistribution || {}).reduce((a, b) => a + b, 0);
    const unassignedCount = Math.max(0, (totalIssues || 0) - assignedCount);
    
    const data = [assignedCount, unassignedCount];
    
    if (totalIssues > 0) {
        window.assignmentChart = new Chart(ctx, {
            type: 'pie',
            data: {
                labels: ['Assigned', 'Unassigned'],
                datasets: [{
                    data: data,
                    backgroundColor: ['#60A5FA', '#F97316'],
                    borderWidth: 3,
                    borderColor: '#ffffff'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: { color: '#374151', padding: 20 }
                    }
                }
            }
        });
    } else {
        ctx.fillStyle = '#6b7280';
        ctx.font = '16px Arial';
        ctx.textAlign = 'center';
        ctx.fillText('No data available', canvas.width / 2, canvas.height / 2);
    }
}

function updateIntegratedRecentActivity(projectIssues, riskIssues) {
    const container = document.getElementById('recentIssues');
    
    const allItems = [];
    
    // Add project issues
    (projectIssues || []).slice(0, 8).forEach(issue => {
        allItems.push({
            ...issue,
            type: 'project',
            icon: '📋'
        });
    });
    
    // Add risk issues
    (riskIssues || []).forEach(risk => {
        allItems.push({
            ...risk,
            type: 'risk',
            icon: '🚨'
        });
    });
    
    // Sort by creation/update date
    allItems.sort((a, b) => new Date(b.created || b.updated) - new Date(a.created || a.updated));
    
    if (allItems.length === 0) {
        container.innerHTML = '<div class="no-tasks">No recent activity</div>';
        return;
    }
    
    container.innerHTML = allItems.slice(0, 12).map(item => {
        const statusClass = getStatusClass(item.status);
        const typeClass = item.type === 'risk' ? 'risk-activity' : 'project-activity';
        
        return `
            <div class="activity-item ${typeClass}">
                <div class="activity-header">
                    <span class="activity-type">${item.icon}</span>
                    <a href="#" class="issue-key-link">${item.key}</a>
                    <span class="status-badge ${statusClass}">${item.status}</span>
                </div>
                <p class="activity-summary">${item.summary}</p>
                <div class="activity-meta">
                    <span>${item.assignee || 'Unassigned'}</span>
                    <span>•</span>
                    <span>${item.type === 'risk' ? 'Risk' : 'Task'}</span>
                    <span>•</span>
                    <span>Updated ${new Date(item.updated || item.created).toLocaleDateString()}</span>
                </div>
            </div>
        `;
    }).join('');
}

function updateIntegratedInsights() {
    const container = document.getElementById('projectInsights');
    const { status_counts, risk_integration } = dashboardData;
    
    let insights = [];
    
    // Risk-specific insights
    if (risk_integration?.high_impact_risks > 0) {
        insights.push({
            type: 'warning',
            title: '⚠️ High-Impact Risks Detected',
            message: `${risk_integration.high_impact_risks} high-impact risks require immediate attention. Consider escalating to project stakeholders.`
        });
    }
    
    // Escalation insight
    if (risk_integration?.escalation_required > 0) {
        insights.push({
            type: 'info',
            title: '📢 Escalation Required',
            message: `${risk_integration.escalation_required} risks require management escalation for resolution.`
        });
    }
    
    // Project progress insight
    if (status_counts.done > 0 && risk_integration?.high_impact_risks === 0) {
        insights.push({
            type: 'success',
            title: '✅ Strong Risk Management',
            message: `Project is progressing well with ${status_counts.done} completed tasks and no critical risks.`
        });
    }
    
    // Assignment insight
    const totalIssues = status_counts.total || 0;
    if (totalIssues > 0) {
        insights.push({
            type: 'info',
            title: '📊 Project Status',
            message: `${totalIssues} total issues with ${Math.round((dashboardData.progress_percentage || 0))}% completion rate.`
        });
    }
    
    container.innerHTML = insights.map(insight => `
        <div class="insight-item insight-${insight.type}">
            <h4>${insight.title}</h4>
            <p>${insight.message}</p>
        </div>
    `).join('');
}

function updateRiskAwareTimeline() {
    const { status_counts, progress_percentage } = dashboardData;
    
    // Timeline logic with risk considerations
    let currentStep = 1;
    let stepText = "Take Over";
    
    if (progress_percentage > 0) {
        currentStep = 2;
        stepText = "Day 0";
    }
    
    if (status_counts.done > 0 && status_counts.done >= status_counts.total * 0.1) {
        currentStep = 3;
        stepText = "GO LIVE INTIATION";
    }
    
    if (status_counts.done >= status_counts.total * 0.25) {
        currentStep = 4;
        stepText = "Readiness for Day !";
    }
    
    if (status_counts.done >= status_counts.total * 0.4) {
        currentStep = 5;
        stepText = "Solution Design";
    }
    
    if (status_counts.done >= status_counts.total * 0.6) {
        currentStep = 6;
        stepText = "Reports";
    }
    
    if (status_counts.done >= status_counts.total * 0.8) {
        currentStep = 7;
        stepText = "Readiness for Go Live";
    }
    
    if (status_counts.done === status_counts.total) {
        currentStep = 8;
        stepText = "GO LIVE";
    }
    
    // Update timeline visual state
    const steps = document.querySelectorAll('.timeline-step');
    const connectors = document.querySelectorAll('.timeline-connector');
    
    steps.forEach((step, index) => {
        const stepNumber = index + 1;
        step.classList.remove('completed', 'current');
        
        if (stepNumber < currentStep) {
            step.classList.add('completed');
        } else if (stepNumber === currentStep) {
            step.classList.add('current');
        }
    });
    
    connectors.forEach((connector, index) => {
        connector.classList.remove('completed');
        if (index + 1 < currentStep) {
            connector.classList.add('completed');
        }
    });
    
    document.getElementById('timelineProgressText').textContent = 
        `Step ${currentStep} of 8 - ${stepText}`;
}

// Board functions
async function updateBoard() {
    if (!currentProject) return;
    
    try {
        const response = await fetch(`${API_BASE}/api/jira/board/${currentProject}`);
        if (!response.ok) {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }
        
        const boardData = await response.json();
        renderProjectBoard(boardData);
        
    } catch (error) {
        console.error('Failed to load board data:', error);
        showBoardError('Failed to load board data: ' + error.message);
    }
}

function renderProjectBoard(boardData) {
    const { board, counts } = boardData;
    
    const boardContainer = document.getElementById('mainBoard');
    boardContainer.innerHTML = `
        <div class="kanban-column">
            <div class="column-header todo-header">
                <h3>📝 To Do</h3>
                <span class="issue-count">${counts.todo || 0}</span>
            </div>
            <div class="column-content">
                ${renderBoardColumn(board.todo || [], 'No tasks to do')}
            </div>
        </div>
        
        <div class="kanban-column">
            <div class="column-header progress-header">
                <h3>🔄 In Progress</h3>
                <span class="issue-count">${counts.in_progress || 0}</span>
            </div>
            <div class="column-content">
                ${renderBoardColumn(board.in_progress || [], 'No tasks in progress')}
            </div>
        </div>
        
        <div class="kanban-column">
            <div class="column-header done-header">
                <h3>✅ Done</h3>
                <span class="issue-count">${counts.done || 0}</span>
            </div>
            <div class="column-content">
                ${renderBoardColumn(board.done || [], 'No completed tasks')}
            </div>
        </div>
    `;
}

function renderBoardColumn(issues, emptyMessage) {
    if (!issues || issues.length === 0) {
        return `<div class="no-issues">${emptyMessage}</div>`;
    }
    
    return issues.map(issue => `
        <div class="issue-card" onclick="openIssueDetails('${issue.key}')">
            <div class="issue-key">${issue.key}</div>
            <div class="issue-summary">${issue.summary || 'No summary'}</div>
            <div class="issue-meta">
                <span class="issue-assignee">${issue.assignee || 'Unassigned'}</span>
                <span class="issue-type">${issue.issuetype || 'Task'}</span>
            </div>
        </div>
    `).join('');
}

function toggleRiskBoard() {
    showRiskBoard = !showRiskBoard;
    const toggleBtn = document.getElementById('board-toggle-btn');
    
    if (showRiskBoard) {
        loadRiskBoard();
        toggleBtn.textContent = '📋 Show Project Board';
    } else {
        updateBoard();
        toggleBtn.textContent = '🚨 Show Risk Board';
    }
}

async function loadRiskBoard() {
    const boardContainer = document.getElementById('mainBoard');
    
    // Use mock risk board data since backend might not be updated yet
    const mockRiskBoard = {
        risk_board: {
            identified: [
                {
                    key: 'RISK-001',
                    summary: 'Cloud Provider Service Outage Risk',
                    status: 'Open',
                    priority: 'High',
                    assignee: 'John Doe',
                    risk_category: 'Operational',
                    impact_level: 'High',
                    third_party: 'AWS'
                }
            ],
            assessment: [
                {
                    key: 'RISK-002',
                    summary: 'Third-Party Data Processing Compliance',
                    status: 'In Review',
                    priority: 'Critical',
                    assignee: 'Jane Smith',
                    risk_category: 'Compliance',
                    impact_level: 'Critical',
                    third_party: 'DataCorp Solutions'
                }
            ],
            mitigation: [],
            monitoring: [],
            closed: [
                {
                    key: 'RISK-003',
                    summary: 'Vendor Financial Stability',
                    status: 'Closed',
                    priority: 'Medium',
                    assignee: 'Bob Johnson',
                    risk_category: 'Financial',
                    impact_level: 'Medium',
                    third_party: 'TechVendor Inc'
                }
            ]
        },
        counts: {
            identified: 1,
            assessment: 1,
            mitigation: 0,
            monitoring: 0,
            closed: 1
        }
    };
    
    renderRiskBoard(mockRiskBoard);
}

function renderRiskBoard(boardData) {
    const { risk_board, counts } = boardData;
    
    const boardContainer = document.getElementById('mainBoard');
    boardContainer.innerHTML = `
        <div class="risk-column">
            <div class="risk-column-header identified-header">
                <h3>🆔 Identified</h3>
                <span class="issue-count">${counts.identified || 0}</span>
            </div>
            <div class="column-content">
                ${renderRiskItems(risk_board.identified || [])}
            </div>
        </div>
        
        <div class="risk-column">
            <div class="risk-column-header assessment-header">
                <h3>📊 Assessment</h3>
                <span class="issue-count">${counts.assessment || 0}</span>
            </div>
            <div class="column-content">
                ${renderRiskItems(risk_board.assessment || [])}
            </div>
        </div>
        
        <div class="risk-column">
            <div class="risk-column-header mitigation-header">
                <h3>🛡️ Mitigation</h3>
                <span class="issue-count">${counts.mitigation || 0}</span>
            </div>
            <div class="column-content">
                ${renderRiskItems(risk_board.mitigation || [])}
            </div>
        </div>
        
        <div class="risk-column">
            <div class="risk-column-header monitoring-header">
                <h3>👁️ Monitoring</h3>
                <span class="issue-count">${counts.monitoring || 0}</span>
            </div>
            <div class="column-content">
                ${renderRiskItems(risk_board.monitoring || [])}
            </div>
        </div>
        
        <div class="risk-column">
            <div class="risk-column-header closed-header">
                <h3>✅ Closed</h3>
                <span class="issue-count">${counts.closed || 0}</span>
            </div>
            <div class="column-content">
                ${renderRiskItems(risk_board.closed || [])}
            </div>
        </div>
    `;
}

function renderRiskItems(items) {
    if (!items || items.length === 0) {
        return '<div class="no-issues">No risks in this stage</div>';
    }
    
    return items.map(risk => `
        <div class="risk-item" onclick="openIssueDetails('${risk.key}')">
            <div class="risk-item-header">
                <span class="risk-key">${risk.key}</span>
                <span class="risk-impact-badge impact-${risk.impact_level.toLowerCase()}">${risk.impact_level}</span>
            </div>
            <div class="risk-summary">${risk.summary}</div>
            <div class="risk-meta">
                <small>${risk.risk_category} | ${risk.assignee}</small>
                <small>${risk.third_party}</small>
            </div>
        </div>
    `).join('');
}

// Risk Modal Functions
function setupRiskModal() {
    // Impact level selection
    document.querySelectorAll('.impact-level-option').forEach(option => {
        option.addEventListener('click', function() {
            document.querySelectorAll('.impact-level-option').forEach(opt => opt.classList.remove('selected'));
            this.classList.add('selected');
        });
    });
    
    // Close modal when clicking outside
    document.getElementById('createRiskModal').addEventListener('click', function(event) {
        if (event.target === this) {
            closeRiskModal();
        }
    });
    
    // ESC key to close modal
    document.addEventListener('keydown', function(event) {
        if (event.key === 'Escape' && document.getElementById('createRiskModal').style.display === 'block') {
            closeRiskModal();
        }
    });
}

function showCreateRiskModal() {
    document.getElementById('createRiskModal').style.display = 'block';
    document.body.style.overflow = 'hidden';
}

function closeRiskModal() {
    document.getElementById('createRiskModal').style.display = 'none';
    document.body.style.overflow = 'auto';
    // Reset form
    document.getElementById('riskForm').reset();
    document.querySelectorAll('.impact-level-option').forEach(opt => opt.classList.remove('selected'));
}

function submitRiskForm(event) {
    event.preventDefault();
    
    // Collect form data
    const selectedImpact = document.querySelector('.impact-level-option.selected');
    const formData = {
        risk_title: document.getElementById('riskTitle').value,
        risk_category: document.getElementById('riskCategory').value,
        third_party: document.getElementById('thirdParty').value,
        risk_description: document.getElementById('riskDescription').value,
        impact_level: selectedImpact ? selectedImpact.dataset.value : null,
        departments_affected: Array.from(document.querySelectorAll('input[name="departments"]:checked')).map(cb => cb.value),
        escalation_required: document.getElementById('escalationRequired').checked,
        recommended_action: document.getElementById('recommendedAction').value
    };
    
    // Validate required fields
    if (!formData.risk_title || !formData.risk_category || !formData.third_party || 
        !formData.risk_description || !formData.impact_level) {
        alert('Please fill in all required fields');
        return;
    }
    
    createRiskTicket(formData);
}

async function createRiskTicket(formData) {
    try {
        // Try to call the backend endpoint
        const response = await fetch(`${API_BASE}/api/risk/create-integrated`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                ...formData,
                project_key: currentProject,
                date_identified: new Date().toISOString().split('T')[0]
            })
        });
        
        if (response.ok) {
            const result = await response.json();
            showSuccess('Risk ticket created successfully!');
            loadDataWithRisks();
            closeRiskModal();
        } else {
            throw new Error('Backend endpoint not available');
        }
    } catch (error) {
        // If backend endpoint doesn't exist, show mock success
        console.log('Risk creation endpoint not available, showing mock success');
        showSuccess('Risk ticket would be created successfully! (Mock response - implement backend endpoint)');
        closeRiskModal();
        
        // Update the mock risk data to include the new risk
        if (riskData) {
            riskData.recent_risks.unshift({
                key: `RISK-${String(Date.now()).slice(-3)}`,
                summary: formData.risk_title,
                status: 'Open',
                category: formData.risk_category,
                impact: formData.impact_level,
                created: new Date().toISOString()
            });
            
            // Update risk counts
            riskData.by_category[formData.risk_category] = (riskData.by_category[formData.risk_category] || 0) + 1;
            riskData.by_impact[formData.impact_level] = (riskData.by_impact[formData.impact_level] || 0) + 1;
            riskData.by_status['Open'] = (riskData.by_status['Open'] || 0) + 1;
            
            dashboardData.total_risks = (dashboardData.total_risks || 0) + 1;
            
            if (formData.impact_level === 'Critical' || formData.impact_level === 'High') {
                dashboardData.risk_integration.high_impact_risks = (dashboardData.risk_integration.high_impact_risks || 0) + 1;
            }
            
            if (formData.escalation_required) {
                dashboardData.risk_integration.escalation_required = (dashboardData.risk_integration.escalation_required || 0) + 1;
            }
            
            // Refresh the dashboard
            updateIntegratedDashboard();
        }
    }
}

// Helper functions
function calculateResolvedRisksThisMonth() {
    if (!riskData?.recent_risks) return 2; // Mock data
    
    const oneMonthAgo = new Date();
    oneMonthAgo.setMonth(oneMonthAgo.getMonth() - 1);
    
    return riskData.recent_risks.filter(risk => 
        risk.status.toLowerCase().includes('closed') || 
        risk.status.toLowerCase().includes('resolved')
    ).length;
}

function getStatusClass(status) {
    const statusLower = status.toLowerCase();
    if (statusLower.includes('done') || statusLower.includes('complete') || statusLower.includes('closed')) {
        return 'status-done';
    } else if (statusLower.includes('progress')) {
        return 'status-progress';
    } else {
        return 'status-todo';
    }
}

function openIssueDetails(issueKey) {
    const jiraUrl = `https://uncia-team-vmevzjmu.atlassian.net/browse/${issueKey}`;
    window.open(jiraUrl, '_blank');
}

function showBoardError(message) {
    const boardContainer = document.getElementById('mainBoard');
    boardContainer.innerHTML = `<div class="no-issues">Error: ${message}</div>`;
}

function showError(message) {
    const container = document.getElementById('error-container');
    container.innerHTML = `
        <div class="error">
            <strong>Error:</strong> ${message}
            <br><small>Make sure your Flask app is running on http://localhost:8000</small>
        </div>
    `;
}

function showSuccess(message) {
    const container = document.getElementById('error-container');
    container.innerHTML = `
        <div class="success">
            <strong>Success:</strong> ${message}
        </div>
    `;
    setTimeout(() => container.innerHTML = '', 3000);
}

// Calendar Functions (keeping existing functionality)
function initializeCalendar() {
    updateCalendarDisplay();
    
    document.getElementById('prevMonth').addEventListener('click', () => {
        currentCalendarDate.setMonth(currentCalendarDate.getMonth() - 1);
        updateCalendarDisplay();
    });
    
    document.getElementById('nextMonth').addEventListener('click', () => {
        currentCalendarDate.setMonth(currentCalendarDate.getMonth() + 1);
        updateCalendarDisplay();
    });
    
    selectedDate = new Date();
    updateSelectedDateDisplay(selectedDate);
    updateDailyTasks();
}

function updateSelectedDateDisplay(date) {
    const monthNames = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
    const dayNames = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];

    document.getElementById('selectedDateMonth').textContent = monthNames[date.getMonth()];
    document.getElementById('selectedDateWeekday').textContent = dayNames[date.getDay()];
    
    const numberEl = document.getElementById('selectedDateNumber');
    numberEl.textContent = date.getDate();
    
    // Trigger pop-in animation
    numberEl.classList.remove('pop-in');
    void numberEl.offsetWidth; // Force DOM reflow
    numberEl.classList.add('pop-in');
}

function updateCalendarDisplay() {
    const monthNames = ["January", "February", "March", "April", "May", "June",
        "July", "August", "September", "October", "November", "December"];
    
    const year = currentCalendarDate.getFullYear();
    const month = currentCalendarDate.getMonth();
    
    document.getElementById('calendarTitle').textContent = `${monthNames[month]} ${year}`;

    const weekdaysContainer = document.getElementById('calendarWeekdays');
    weekdaysContainer.innerHTML = '';
    const weekdays = ['S', 'M', 'T', 'W', 'T', 'F', 'S'];
    weekdays.forEach(day => {
        const weekdayElement = document.createElement('div');
        weekdayElement.className = 'calendar-weekday';
        weekdayElement.textContent = day;
        weekdaysContainer.appendChild(weekdayElement);
    });
    
    const calendarGrid = document.getElementById('calendarGrid');
    calendarGrid.innerHTML = '';
    // Re-trigger grid fade animation
    calendarGrid.classList.remove('calendar-grid');
    void calendarGrid.offsetWidth;
    calendarGrid.classList.add('calendar-grid');
    
    // Get first day of month and number of days
    const firstDay = new Date(year, month, 1);
    const lastDay = new Date(year, month + 1, 0);
    const daysInMonth = lastDay.getDate();
    const startingDay = firstDay.getDay();
    
    // Add previous month's days
    const prevMonth = new Date(year, month - 1, 0);
    for (let i = startingDay - 1; i >= 0; i--) {
        const day = prevMonth.getDate() - i;
        const dayElement = createCalendarDay(day, true, new Date(year, month - 1, day));
        calendarGrid.appendChild(dayElement);
    }
    
    // Add current month's days
    for (let day = 1; day <= daysInMonth; day++) {
        const dayElement = createCalendarDay(day, false, new Date(year, month, day));
        calendarGrid.appendChild(dayElement);
    }
    
    // Add next month's days to fill grid
    const totalCells = calendarGrid.children.length;
    const remainingCells = 42 - totalCells; // 6 rows × 7 days
    for (let day = 1; day <= remainingCells; day++) {
        const dayElement = createCalendarDay(day, true, new Date(year, month + 1, day));
        calendarGrid.appendChild(dayElement);
    }
}

function createCalendarDay(day, isOtherMonth, date) {
    const dayElement = document.createElement('div');
    dayElement.className = 'calendar-day';
    dayElement.textContent = day;
    
    if (isOtherMonth) {
        dayElement.classList.add('other-month');
    }
    
    // Check if it's today
    const today = new Date();
    if (date.toDateString() === today.toDateString()) {
        dayElement.classList.add('today');
    }
    
    // Check if it's selected date
    if (date.toDateString() === selectedDate.toDateString()) {
        dayElement.classList.add('selected');
    }
    
    // Check if this date has tasks
    const tasksOnDate = getTasksForDate(date);
    if (tasksOnDate.length > 0) {
        dayElement.classList.add('has-tasks');
        const dot = document.createElement('span');
        dot.className = 'calendar-task-dot';
        dayElement.appendChild(dot);
    }
    
    // Add click event
    dayElement.addEventListener('click', () => {
        // Remove previous selection
        document.querySelectorAll('.calendar-day.selected').forEach(el => {
            el.classList.remove('selected');
        });
        
        // Add selection to clicked day
        dayElement.classList.add('selected');
        selectedDate = new Date(date);
        updateSelectedDateDisplay(selectedDate);
        updateDailyTasks();
    });
    
    return dayElement;
}

function getTasksForDate(date) {
    if (!allIssuesData || allIssuesData.length === 0) {
        return [];
    }
    
    const dateString = date.toDateString();
    
    return allIssuesData.filter(issue => {
        let taskDate = null;
        
        if (issue.duedate) {
            taskDate = new Date(issue.duedate);
        } else if (issue.created) {
            taskDate = new Date(issue.created);
        }
        
        if (taskDate) {
            return taskDate.toDateString() === dateString;
        }
        return false;
    });
}

function updateDailyTasks() {
    const tasksOnDate = getTasksForDate(selectedDate);
    const titleElement = document.getElementById('selectedDateTitle');
    const tasksListElement = document.getElementById('dailyTasksList');
    
    const dateStr = selectedDate.toLocaleDateString('en-US', { 
        weekday: 'long', 
        year: 'numeric', 
        month: 'long', 
        day: 'numeric' 
    });
    
    titleElement.innerHTML = `📋 Tasks for ${dateStr}`;
    
    if (tasksOnDate.length === 0) {
        tasksListElement.innerHTML = '<div class="no-tasks">No tasks due or created on this date</div>';
        return;
    }
    // Reset fade-in for task items
    tasksListElement.innerHTML = '';
    tasksOnDate.forEach((task, idx) => {
        const dateType = task.duedate ? 'Due' : 'Created';
        const typeName = task.issuetype && task.issuetype.name ? task.issuetype.name : 'Task';
        const priorityName = task.priority && task.priority.name ? task.priority.name : '';
        const priorityClass = priorityName ? getPriorityClass(priorityName.toLowerCase()) : '';
        const html = `
            <div class="task-item" style="animation-delay: ${idx * 0.07}s" onclick="openIssueDetails('${task.key}')">
                <div class="activity-header">
                    <span class="activity-key">${task.key}</span>
                    <span class="activity-status-badge">${dateType}</span>
                    ${priorityName ? `<span class=\"activity-status-badge\" style=\"background:#fef3c7;color:#b45309;\">${priorityName}</span>` : ''}
                    <span class="activity-type">${typeName}</span>
                </div>
                <div class="activity-summary">${task.summary || 'No summary'}</div>
                <div class="activity-meta">
                    <span class="activity-assignee">${task.assignee && task.assignee.name ? task.assignee.name : 'Unassigned'}</span>
                    <span>Start: ${task.created ? new Date(task.created).toLocaleDateString() : 'N/A'}</span>
                </div>
            </div>
        `;
        tasksListElement.insertAdjacentHTML('beforeend', html);
    });
}

function getPriorityClass(priority) {
    switch(priority) {
        case 'highest': return 'priority-highest';
        case 'high': return 'priority-high';
        case 'medium': return 'priority-medium';
        case 'low': return 'priority-low';
        case 'lowest': return 'priority-lowest';
        default: return 'priority-medium';
    }
}

async function loadAllIssuesForCalendar() {
    if (!currentProject) return;
    
    try {
        const response = await fetch(`${API_BASE}/api/jira/issues/${currentProject}`);
        if (!response.ok) {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }
        
        const issuesData = await response.json();
        allIssuesData = issuesData.issues || [];
        
        // Update calendar to show tasks
        updateCalendarDisplay();
        updateDailyTasks();
        
    } catch (error) {
        console.error('Failed to load issues for calendar:', error);
    }
}

function setupIntersectionObserver() {
    const options = {
        root: null,
        rootMargin: '0px',
        threshold: 0.3
    };

    const observer = new IntersectionObserver((entries, observer) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.classList.add('in-view');
                observer.unobserve(entry.target);
            }
        });
    }, options);

    const timeline = document.querySelector('.timeline-section');
    if (timeline) {
        observer.observe(timeline);
    }
}

// Timeline animation triggers
document.addEventListener('DOMContentLoaded', function() {
    const timelineSection = document.querySelector('.timeline-section');
    if (timelineSection) {
        timelineSection.classList.add('in-view');
        
        // Animate timeline steps and connectors
        const steps = document.querySelectorAll('.timeline-step');
        const connectors = document.querySelectorAll('.timeline-connector');
        
        steps.forEach((step, index) => {
            setTimeout(() => {
                step.style.opacity = '1';
                step.style.transform = 'translateY(0)';
            }, index * 100);
        });
        
        connectors.forEach((connector, index) => {
            setTimeout(() => {
                connector.style.transform = 'scaleX(1)';
            }, (index + 1) * 150);
        });
    }
});

function renderCalendar(year, month) {
  // ... existing code ...
  for (let day = 1; day <= daysInMonth; day++) {
    const dateStr = `${year}-${String(month+1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
    let marker = '';
    if (taskDates.includes(dateStr)) {
      marker = '<span class="calendar-task-dot"></span>';
    }
    // Render the day cell, e.g.:
    calendarHTML += `<div class="calendar-day">${day}${marker}</div>`;
  }
  // ... existing code ...
}
</script>
</body>
</html>