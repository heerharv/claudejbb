<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>UNCIA Jira Dashboard</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
<style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    background: linear-gradient(135deg, #552E8C 0%, #6B46C1 25%, #552E8C 50%, #7C3AED 75%, #552E8C 100%);
    min-height: 100vh;
    color: #333;
}

.header {
    background: rgba(85, 46, 140, 0.95);
    backdrop-filter: blur(20px);
    padding: 1rem 2rem;
    box-shadow: 0 8px 40px rgba(85, 46, 140, 0.4);
    border-bottom: 1px solid rgba(255,255,255,0.2);
    display: flex;
    align-items: center;
    gap: 1.5rem;
}

.header-logo {
    height: 60px;
    width: auto;
    flex-shrink: 0;
}

.header-content {
    flex: 1;
}

.header h1 {
    color: #ffffff;
    font-size: 2rem;
    font-weight: 700;
    text-shadow: 0 2px 10px rgba(0,0,0,0.3);
    margin: 0;
}

.header p {
    color: rgba(255,255,255,0.9);
    margin-top: 0.5rem;
}

.container {
    max-width: 95vw;
    margin: 0 auto;
    padding: 2rem;
    background: linear-gradient(135deg, #fafbff 0%, #f8fafc 100%);
    min-height: calc(100vh - 120px);
}

.controls {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    border-radius: 12px;
    padding: 1.5rem;
    margin-bottom: 2rem;
    box-shadow: 0 4px 20px rgba(0,0,0,0.1);
}

.project-selector {
    display: flex;
    align-items: center;
    gap: 1rem;
    flex-wrap: wrap;
}

.project-selector label {
    font-weight: 600;
    color: #2d3748;
}

.project-selector select {
    padding: 0.75rem 1rem;
    border: 2px solid #e2e8f0;
    border-radius: 8px;
    background: white;
    font-size: 1rem;
    min-width: 200px;
    cursor: pointer;
    transition: all 0.2s;
}

.project-selector select:focus {
    outline: none;
    border-color: #667eea;
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
}

.refresh-btn {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border: none;
    padding: 0.75rem 1.5rem;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
}

.refresh-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
}

.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1.5rem;
    margin-bottom: 2rem;
}

.stat-card {
    background: #ffffff;
    border-radius: 16px;
    padding: 1.5rem;
    box-shadow: 0 4px 24px rgba(85, 46, 140, 0.18), 0 1.5px 6px rgba(0,0,0,0.08);
    border: 1px solid rgba(85, 46, 140, 0.1);
    transition: all 0.3s;
    position: relative;
}

.stat-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 4px;
    background: linear-gradient(90deg, #552E8C, #7C3AED);
}

.stat-card:hover {
    transform: translateY(-8px);
    box-shadow: 0 12px 40px rgba(85, 46, 140, 0.2);
    border-color: #552E8C;
}

.stat-card h3 {
    color: #552E8C;
    font-size: 0.9rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-bottom: 0.5rem;
    margin-top: 0.5rem;
}

.stat-card .value {
    font-size: 2.5rem;
    font-weight: 700;
    margin-bottom: 0.5rem;
    color: #552E8C;
}

.stat-card .label {
    color: #6b7280;
    font-size: 0.9rem;
}

.total .value { color: #60A5FA; }
.completed .value { color: #34D399; }
.progress .value { color: #FBBF24; }
.todo .value { color: #F87171; }

.progress-section {
    background: #ffffff;
    border-radius: 16px;
    padding: 1.5rem;
    margin-bottom: 2rem;
    box-shadow: 0 4px 24px rgba(85, 46, 140, 0.18), 0 1.5px 6px rgba(0,0,0,0.08);
    border: 1px solid rgba(85, 46, 140, 0.1);
    position: relative;
}

.progress-section::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 4px;
    background: linear-gradient(90deg, #552E8C, #7C3AED);
}

.progress-section h2 {
    color: #552E8C;
    margin-bottom: 1rem;
    font-size: 1.5rem;
    margin-top: 0.5rem;
}

.progress-section p {
    color: #552E8C;
    font-weight: 600;
    font-size: 1.1rem;
}

.progress-bar-container {
    background: #f3f4f6;
    border-radius: 12px;
    height: 12px;
    overflow: hidden;
    margin-bottom: 1rem;
    border: 1px solid #e5e7eb;
}

.progress-bar {
    height: 100%;
    background: linear-gradient(90deg, #34D399 0%, #10B981 100%);
    border-radius: 12px;
    transition: width 1s ease-in-out;
}

/* Animation Keyframes */
@keyframes fadeIn {
    from { opacity: 0; transform: translateY(8px); }
    to { opacity: 1; transform: translateY(0); }
}

@keyframes popIn {
    0% { transform: scale(0.8); opacity: 0; }
    80% { transform: scale(1.1); opacity: 1; }
    100% { transform: scale(1); opacity: 1; }
}

@keyframes draw-line {
    from { transform: scaleX(0); }
    to { transform: scaleX(1); }
}

/* New Calendar Styles */
.calendar-widget-new {
    display: flex;
    gap: 1.5rem;
    background: white;
    border-radius: 16px;
    padding: 1.5rem;
    border: 1px solid #e2e8f0;
    box-shadow: 0 8px 25px rgba(0,0,0,0.15);
    line-height: 1;
    color: #552E8C;
    transition: all 0.3s ease;
}

.selected-date-display {
    flex: 0 0 140px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    color: #2d3748;
    border-right: 1px solid #eef2f7;
    padding-right: 1.5rem;
    text-align: center;
}

.selected-date-month {
    font-size: 1.75rem;
    font-weight: 700;
    line-height: 1.2;
}

.selected-date-weekday {
    font-size: 1.1rem;
    color: #718096;
    margin-bottom: 0.5rem;
}

.selected-date-number {
    font-size: 5.5rem;
    font-weight: 800;
    line-height: 1;
    color: #552E8C;
}

.selected-date-number.pop-in {
    animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
}

.mini-calendar {
    flex: 1;
    display: flex;
    flex-direction: column;
}

/* Calendar Styles */
.calendar-section {
    background: linear-gradient(90deg, #552E8C, #7C3AED);
    border-radius: 16px;
    padding: 1.5rem;
    margin: 2rem 0;
    box-shadow: 0 4px 24px rgba(85, 46, 140, 0.18), 0 1.5px 6px rgba(0,0,0,0.08);
    border: 1px solid rgba(85, 46, 140, 0.1);
    position: relative;
}

.calendar-section::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 4px;
    background: linear-gradient(90deg, #552E8C, #7C3AED);
}

.calendar-section h2 {
    color: #ffffff;
    margin-bottom: 1.5rem;
    font-size: 1.5rem;
    margin-top: 0.5rem;
}

.calendar-container {
    display: grid;
    grid-template-columns: 1.5fr 1fr 1fr;
    gap: 1.5rem;
    align-items: stretch;
}

.calendar-widget {
    background: #f8fafc;
    border-radius: 12px;
    padding: 1rem;
    border: 1px solid #e2e8f0;
    box-shadow: 0 8px 25px rgba(0,0,0,0.15);
    font-weight: 600;
    color: #2d3748;
    font-size: 1.1rem;
}

.calendar-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
    padding: 0 0.5rem;
}

.calendar-nav {
    background: none;
    border: none;
    color: #552E8C;
    font-size: 1.2rem;
    cursor: pointer;
    padding: 0.5rem;
    border-radius: 50%;
    transition: all 0.2s;
}

.calendar-nav:hover {
    background: rgba(85, 46, 140, 0.1);
}

.calendar-title {
    font-weight: 600;
    color: #2d3748;
    font-size: 1.1rem;
}

.calendar-weekdays {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 2px;
    margin-bottom: 0.5rem;
}

.calendar-weekday {
    text-align: center;
    font-weight: 700;
    color: #4a5568;
    font-size: 0.9rem;
    padding: 0.5rem 0;
}

.calendar-grid {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 4px;
}

.calendar-day {
    aspect-ratio: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    background: white;
    border-radius: 50%;
    cursor: pointer;
    transition: all 0.2s;
    position: relative;
    border: 2px solid transparent;
    font-size: 0.9rem;
}

.calendar-day:hover {
    background: #f7f3ff;
    border-color: #ddd6fe;
    transform: translateY(-2px);
    box-shadow: 0 4px 10px rgba(0,0,0,0.08);
}

.calendar-day.other-month {
    color: #cbd5e0;
    background: none;
    border-radius: 8px;
    padding: 1rem;
    border: 1px solid #e2e8f0;
    transition: all 0.3s ease;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    opacity: 0;
    animation: fadeIn 0.4s ease-out forwards;
}

.calendar-day.today {
    border-color: #552E8C;
    font-weight: 700;
}

.calendar-day.has-tasks {
    background: none;
    color: #2d3748;
    font-weight: normal;
}

.calendar-day.has-tasks.today {
    border-color: #552E8C;
}

.calendar-day.selected {
    background: #552E8C;
    color: white;
    font-weight: 700;
    border-color: #552E8C;
}

.task-indicator {
    position: absolute;
    bottom: 5px;
    left: 50%;
    transform: translateX(-50%);
    width: 5px;
    height: 5px;
    background: #c084fc;
    border-radius: 50%;
}

.calendar-day.has-tasks .task-indicator {
    background: #a855f7;
}

.calendar-day.selected .task-indicator {
    background: white;
}

.daily-tasks {
    background: #f8fafc;
    border-radius: 12px;
    padding: 1rem;
    border: 1px solid #e2e8f0;
    max-height: 400px;
    overflow-y: auto;
    box-shadow: 0 8px 25px rgba(0,0,0,0.15);
}

.daily-tasks h3 {
    color: #2d3748;
    margin-bottom: 1rem;
    font-size: 1rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.tasks-list {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
}

.task-item {
    background: white;
    border-radius: 8px;
    padding: 1rem;
    border: 1px solid #e2e8f0;
    transition: all 0.2s;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
}

.task-item:hover {
    border-color: #552E8C;
    box-shadow: 0 8px 20px rgba(85, 46, 140, 0.25);
    transform: translateY(-2px);
}

.task-key {
    font-size: 0.8rem;
    font-weight: 600;
    color: #552E8C;
    margin-bottom: 0.25rem;
}

.task-summary {
    font-size: 0.9rem;
    color: #2d3748;
    margin-bottom: 0.5rem;
    line-height: 1.3;
}

.task-meta {
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 0.75rem;
    color: #718096;
}

.task-assignee {
    background: #edf2f7;
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
    font-weight: 500;
}

.task-priority {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    display: inline-block;
}

.priority-highest { background: #dc2626; }
.priority-high { background: #ea580c; }
.priority-medium { background: #d97706; }
.priority-low { background: #65a30d; }
.priority-lowest { background: #059669; }

.no-tasks {
    text-align: center;
    color: #a0aec0;
    padding: 2rem;
    font-style: italic;
}

/* Timeline Styles */
.timeline-section {
    background: #ffffff;
    border-radius: 16px;
    padding: 1.5rem;
    margin-bottom: 2rem;
    box-shadow: 0 4px 24px rgba(85, 46, 140, 0.18), 0 1.5px 6px rgba(0,0,0,0.08);
    border: 1px solid rgba(85, 46, 140, 0.1);
    position: relative;
}

.timeline-section::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 4px;
    background: linear-gradient(90deg, #552E8C, #7C3AED);
}

.timeline-section h2 {
    color: #552E8C;
    margin-bottom: 1.5rem;
    font-size: 1.5rem;
    margin-top: 0.5rem;
}

.timeline-container {
    display: flex;
    align-items: center;
    justify-content: space-between;
    position: relative;
    padding: 2rem 0;
    overflow-x: auto;
    min-width: 1000px;
}

.timeline-step {
    display: flex;
    flex-direction: column;
    align-items: center;
    min-width: 100px;
    z-index: 2;
    opacity: 0;
    transform: translateY(20px);
    transition: opacity 0.5s ease-out, transform 0.5s ease-out;
}

.step-number {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    font-size: 1.2rem;
    margin-bottom: 0.75rem;
    border: 3px solid #e2e8f0;
    background: white;
    color: #718096;
    transition: all 0.3s ease;
}

.timeline-step.completed .step-number {
    background: linear-gradient(135deg, #38a169 0%, #48bb78 100%);
    border-color: #38a169;
    color: white;
    position: relative;
}

.timeline-step.completed .step-number::after {
    content: '‚úì';
    font-size: 1rem;
    position: absolute;
}

.timeline-step.current .step-number {
    background: linear-gradient(135deg, #552E8C 0%, #7C3AED 100%);
    border-color: #552E8C;
    color: white;
    animation: pulse 2s infinite;
}

@keyframes pulse {
    0% { box-shadow: 0 0 0 0 rgba(85, 46, 140, 0.7); }
    70% { box-shadow: 0 0 0 10px rgba(85, 46, 140, 0); }
    100% { box-shadow: 0 0 0 0 rgba(85, 46, 140, 0); }
}

.step-content {
    text-align: center;
    max-width: 100px;
}

.step-content h4 {
    color: #552E8C;
    font-size: 0.85rem;
    font-weight: 600;
    margin-bottom: 0.25rem;
}

.step-content p {
    color: #6b7280;
    font-size: 0.7rem;
    line-height: 1.2;
}

.timeline-connector {
    height: 4px;
    background: #e5e7eb;
    flex: 1;
    margin: 0 10px;
    border-radius: 2px;
    position: relative;
    top: -40px;
    transform: scaleX(0);
    transform-origin: left;
    transition: transform 0.4s ease-out;
}

.timeline-connector.completed {
    background: linear-gradient(90deg, #34D399 0%, #10B981 100%);
}

.timeline-progress-text {
    text-align: center;
    margin-top: 1rem;
    color: #552E8C;
    font-weight: 600;
}

.charts-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
    gap: 2rem;
    margin-bottom: 2rem;
}

/* Kanban Board Styles */
.board-section {
    background: rgba(85, 46, 140, 0.8);
    backdrop-filter: blur(20px);
    border-radius: 16px;
    padding: 1.5rem;
    margin-bottom: 2rem;
    box-shadow: 0 4px 24px rgba(85, 46, 140, 0.18), 0 1.5px 6px rgba(0,0,0,0.08);
    border: 1px solid rgba(255,255,255,0.2);
}

.board-section::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 4px;
    background: linear-gradient(90deg, #552E8C, #7C3AED);
}

.board-section h2 {
    color: #fff;
    margin-bottom: 1.5rem;
    font-size: 1.5rem;
    margin-top: 0.5rem;
}

.kanban-board {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 1.5rem;
    min-height: 500px;
}

.kanban-column {
    background: rgba(255, 255, 255, 0.95);
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 4px 16px rgba(85, 46, 140, 0.10), 0 1px 3px rgba(0,0,0,0.06);
}

.column-header {
    padding: 1rem 1.5rem;
    font-weight: 600;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 1px solid rgba(0,0,0,0.1);
}

.todo-header {
    background: linear-gradient(135deg, #9370DB, #8A2BE2);
    color: white;
}

.progress-header {
    background: linear-gradient(135deg, #6B46C1, #552E8C);
    color: white;
}

.done-header {
    background: linear-gradient(135deg, #552E8C, #483D8B);
    color: white;
}

.column-header h3 {
    margin: 0;
    font-size: 1rem;
}

.issue-count {
    background: rgba(255,255,255,0.3);
    color: white;
    padding: 0.25rem 0.75rem;
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: 700;
}

.column-content {
    padding: 1rem;
    max-height: 450px;
    overflow-y: auto;
}

.issue-card {
    background: white;
    border: 1px solid #e2e8f0;
    border-radius: 8px;
    padding: 1rem;
    margin-bottom: 0.75rem;
    cursor: pointer;
    transition: all 0.2s;
    box-shadow: 0 2px 8px rgba(85, 46, 140, 0.10), 0 1px 3px rgba(0,0,0,0.06);
}

.issue-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    border-color: #552E8C;
}

.issue-card:last-child {
    margin-bottom: 0;
}

.issue-key {
    font-size: 0.75rem;
    font-weight: 600;
    color: #552E8C;
    margin-bottom: 0.5rem;
}

.issue-summary {
    font-size: 0.9rem;
    font-weight: 500;
    color: #2d3748;
    margin-bottom: 0.75rem;
    line-height: 1.4;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
}

.issue-meta {
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 0.75rem;
}

.issue-assignee {
    color: #718096;
    background: #f7fafc;
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
    font-weight: 500;
}

.issue-type {
    color: #552E8C;
    font-weight: 600;
}

.loading-board {
    text-align: center;
    color: #718096;
    padding: 2rem;
    font-style: italic;
}

.no-issues {
    text-align: center;
    color: #a0aec0;
    padding: 2rem;
    font-style: italic;
}

.issue-priority {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    display: inline-block;
    margin-left: 0.5rem;
}

.priority-highest { background: #dc2626; }
.priority-high { background: #ea580c; }
.priority-medium { background: #d97706; }
.priority-low { background: #65a30d; }
.priority-lowest { background: #059669; }

.chart-card {
    background: rgba(85, 46, 140, 0.8);
    backdrop-filter: blur(20px);
    border-radius: 16px;
    padding: 1.5rem;
    box-shadow: 0 8px 32px rgba(85, 46, 140, 0.4);
    border: 1px solid rgba(255,255,255,0.2);
    height: 320px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
}

.chart-card h3 {
    color: #ffffff;
    margin-bottom: 1rem;
    font-size: 1.25rem;
}

.recent-activity {
    background: #f8fafc;
    border-radius: 12px;
    padding: 1.5rem;
    box-shadow: 0 8px 25px rgba(0,0,0,0.15);
    border: 1px solid #e2e8f0;
    max-height: 450px;
    overflow-y: auto;
    scrollbar-width: none; /* Firefox */
    -ms-overflow-style: none;  /* IE and Edge */
}
.recent-activity::-webkit-scrollbar {
    display: none;
}

.recent-activity h2, .recent-activity h3 {
    color: #2d3748;
    margin-bottom: 1rem;
    font-size: 1.1rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.activity-item {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
    padding: 1rem;
    margin-bottom: 0.75rem;
    background: #fff;
    border-radius: 8px;
    border-left: 4px solid #8b5cf6;
    box-shadow: 0 2px 4px rgba(0,0,0,0.06);
    opacity: 0;
    animation: fadeIn 0.4s ease-out forwards;
}

.activity-item:last-child {
    margin-bottom: 0;
}

.activity-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.issue-key-link {
    font-weight: 600;
    color: #552E8C;
    text-decoration: none;
    font-size: 0.9rem;
}
.issue-key-link:hover {
    text-decoration: underline;
}

.activity-summary {
    color: #374151;
    font-size: 0.95rem;
    line-height: 1.4;
    margin: 0;
}

.activity-meta {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.8rem;
    color: #718096;
}

.status-badge {
    padding: 0.25rem 0.75rem;
    border-radius: 20px;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
}

.status-todo { background: #fed7d7; color: #c53030; }
.status-progress { background: #feebc8; color: #dd6b20; }
.status-done { background: #c6f6d5; color: #38a169; }

.loading {
    text-align: center;
    padding: 3rem;
    color: #552E8C;
    font-size: 1.2rem;
}

.error {
    background: rgba(248, 113, 113, 0.9);
    color: #ffffff;
    padding: 1rem;
    border-radius: 12px;
    margin-bottom: 1rem;
    border: 1px solid rgba(255,255,255,0.3);
    backdrop-filter: blur(10px);
}

.warning {
    background: rgba(251, 191, 36, 0.9);
    color: #ffffff;
    padding: 1rem;
    border-radius: 12px;
    margin-bottom: 1rem;
    border: 1px solid rgba(255,255,255,0.3);
    backdrop-filter: blur(10px);
}

.insights {
    background: #dcd0ee;
    backdrop-filter: blur(10px);
    border-radius: 12px;
    padding: 1.5rem;
    margin-top: 2rem;
    box-shadow: 0 4px 24px rgba(85, 46, 140, 0.18), 0 1.5px 6px rgba(0,0,0,0.08);
}

.insights h2 {
    color: #2d3748;
    margin-bottom: 1rem;
    font-size: 1.5rem;
}

.insight-item {
    padding: 1rem;
    margin-bottom: 1rem;
    border-radius: 8px;
    border-left: 4px solid #38a169;
    box-shadow: 0 2px 12px rgba(85, 46, 140, 0.10), 0 1px 3px rgba(0,0,0,0.06);
}

.insight-warning { 
    background: #fef5e7; 
    border-left-color: #ed8936; 
}

.insight-success { 
    background: #f0fff4; 
    border-left-color: #38a169; 
}

.insight-info { 
    background: #ebf8ff; 
    border-left-color: #3182ce; 
}

@media (max-width: 768px) {
    .container {
        padding: 1rem;
    }
    
    .header {
        padding: 1rem;
        flex-direction: column;
        text-align: center;
        gap: 1rem;
    }
    
    .header-logo {
        height: 50px;
    }
    
    .header h1 {
        font-size: 1.5rem;
    }
    
    .project-selector {
        flex-direction: column;
        align-items: stretch;
    }
    
    .project-selector select {
        min-width: auto;
    }
    
    .charts-grid {
        grid-template-columns: 1fr;
    }
    
    .chart-container {
        height: 280px;
        width: 280px;
    }
    
    .chart-container canvas {
        max-width: 280px !important;
        max-height: 280px !important;
        width: 280px !important;
        height: 280px !important;
    }
    
    /* Mobile Kanban Board */
    .kanban-board {
        grid-template-columns: 1fr;
        gap: 1rem;
    }
    
    .kanban-column {
        max-height: 300px;
    }
    
    .column-content {
        max-height: 220px;
    }
    
    .issue-card {
        padding: 0.75rem;
        margin-bottom: 0.5rem;
    }
    
    .issue-summary {
        font-size: 0.85rem;
        -webkit-line-clamp: 3;
    }
    
    .timeline-container {
        flex-direction: column;
        min-width: auto;
        gap: 1rem;
    }
    
    .timeline-connector {
        display: none;
    }
    
    .timeline-step {
        flex-direction: row;
        text-align: left;
        width: 100%;
        min-width: auto;
    }
    
    .step-number {
        margin-right: 1rem;
        margin-bottom: 0;
    }
    
    .step-content {
        text-align: left;
        max-width: none;
    }
    
    /* Mobile Calendar */
    .calendar-container {
        grid-template-columns: 1fr;
        gap: 1rem;
    }
    
    .calendar-widget {
        order: 2;
    }
    
    .daily-tasks {
        order: 1;
        max-height: 250px;
    }
    
    .calendar-grid {
        gap: 1px;
    }
    
    .calendar-day {
        font-size: 0.8rem;
        min-height: 32px;
    }
    
    .task-item {
        padding: 0.75rem;
    }
    
    .task-summary {
        font-size: 0.85rem;
    }
}

.timeline-section.in-view .timeline-step,
.timeline-section.in-view .timeline-connector {
    opacity: 1;
    transform: translateY(0) scaleX(1);
}

.timeline-section.in-view .timeline-step:nth-of-type(1) { transition-delay: 0.1s; }
.timeline-section.in-view .timeline-connector:nth-of-type(1) { transition-delay: 0.2s; }
.timeline-section.in-view .timeline-step:nth-of-type(2) { transition-delay: 0.3s; }
.timeline-section.in-view .timeline-connector:nth-of-type(2) { transition-delay: 0.4s; }
.timeline-section.in-view .timeline-step:nth-of-type(3) { transition-delay: 0.5s; }
.timeline-section.in-view .timeline-connector:nth-of-type(3) { transition-delay: 0.6s; }
.timeline-section.in-view .timeline-step:nth-of-type(4) { transition-delay: 0.7s; }
.timeline-section.in-view .timeline-connector:nth-of-type(4) { transition-delay: 0.8s; }
.timeline-section.in-view .timeline-step:nth-of-type(5) { transition-delay: 0.9s; }
.timeline-section.in-view .timeline-connector:nth-of-type(5) { transition-delay: 1.0s; }
.timeline-section.in-view .timeline-step:nth-of-type(6) { transition-delay: 1.1s; }
.timeline-section.in-view .timeline-connector:nth-of-type(6) { transition-delay: 1.2s; }
.timeline-section.in-view .timeline-step:nth-of-type(7) { transition-delay: 1.3s; }
.timeline-section.in-view .timeline-connector:nth-of-type(7) { transition-delay: 1.4s; }
.timeline-section.in-view .timeline-step:nth-of-type(8) { transition-delay: 1.5s; }
</style>
</head>
<body>
<div class="header">
    <img src="uncia_logo.png" alt="UNCIA Logo" style="height:40px; width:auto; display:block; margin-right:16px;"/>
    <div class="header-content">
        <h1>UNCIA Jira Dashboard</h1>
    </div>
</div>

<div class="container">
<div class="controls">
    <div class="project-selector">
        <label for="projectSelect">Select Project:</label>
        <select id="projectSelect">
            <option value="">Loading projects...</option>
        </select>
        <button class="refresh-btn" onclick="loadData()">üîÑ Refresh</button>
    </div>
</div>

<div id="error-container"></div>
<div id="loading" class="loading">Loading dashboard data...</div>
<div id="dashboard" style="display: none;">
    
    <div class="stats-grid">
        <div class="stat-card total">
            <h3>Total Issues</h3>
            <div class="value" id="totalIssues">-</div>
            <div class="label">All issues in project</div>
        </div>
        <div class="stat-card completed">
            <h3>Completed</h3>
            <div class="value" id="completedIssues">-</div>
            <div class="label">Done & resolved</div>
        </div>
        <div class="stat-card progress">
            <h3>In Progress</h3>
            <div class="value" id="progressIssues">-</div>
            <div class="label">Currently active</div>
        </div>
        <div class="stat-card todo">
            <h3>To Do</h3>
            <div class="value" id="todoIssues">-</div>
            <div class="label">Pending work</div>
        </div>
    </div>

    <!-- Updated Project Timeline Section with UNCIA-specific steps -->
    <div class="timeline-section">
        <h2>Project Implementation Timeline</h2>
        <div class="timeline-container">
            <div class="timeline-step completed" data-step="1">
                <div class="step-number">1</div>
                <div class="step-content">
                    <h4>Take Over</h4>
                    <p>Project handover & onboarding</p>
                </div>
            </div>
            <div class="timeline-connector completed"></div>
            
            <div class="timeline-step completed" data-step="2">
                <div class="step-number">2</div>
                <div class="step-content">
                    <h4>Day 0</h4>
                    <p>Initial setup & kickoff</p>
                </div>
            </div>
            <div class="timeline-connector completed"></div>
            
            <div class="timeline-step current" data-step="3">
                <div class="step-number">3</div>
                <div class="step-content">
                    <h4>GO LIVE INTIATION</h4>
                    <p>First deployment</p>
                </div>
            </div>
            <div class="timeline-connector"></div>
            
            <div class="timeline-step" data-step="4">
                <div class="step-number">4</div>
                <div class="step-content">
                    <h4>Readiness for Day !</h4>
                    <p>Preparation phase</p>
                </div>
            </div>
            <div class="timeline-connector"></div>
            
            <div class="timeline-step" data-step="5">
                <div class="step-number">5</div>
                <div class="step-content">
                    <h4>Solution Design</h4>
                    <p>Architecture & planning</p>
                </div>
            </div>
            <div class="timeline-connector"></div>
            
            <div class="timeline-step" data-step="6">
                <div class="step-number">6</div>
                <div class="step-content">
                    <h4>Reports</h4>
                    <p>Documentation & analysis</p>
                </div>
            </div>
            <div class="timeline-connector"></div>
            
            <div class="timeline-step" data-step="7">
                <div class="step-number">7</div>
                <div class="step-content">
                    <h4>Readiness for Go Live</h4>
                    <p>Final preparation</p>
                </div>
            </div>
            <div class="timeline-connector"></div>
            
            <div class="timeline-step" data-step="8">
                <div class="step-number">8</div>
                <div class="step-content">
                    <h4>GO LIVE</h4>
                    <p>Production launch</p>
                </div>
            </div>
        </div>
        <div class="timeline-progress-text">
            <span id="timelineProgressText">Step 3 of 8 - GO LIVE INTIATION Phase</span>
        </div>
    </div>

    <div class="progress-section">
        <h2>üìä Project Progress</h2>
        <div class="progress-bar-container">
            <div class="progress-bar" id="progressBar" style="width: 0%"></div>
        </div>
        <p id="progressText">0% Complete</p>
    </div>

    <!-- Calendar Widget Section -->
    <div class="calendar-section">
        <h2>üìÖ Project Calendar</h2>
        <div class="calendar-container">
            <div class="calendar-widget-new">
                <div class="selected-date-display">
                    <div class="selected-date-month" id="selectedDateMonth"></div>
                    <div class="selected-date-weekday" id="selectedDateWeekday"></div>
                    <div class="selected-date-number" id="selectedDateNumber"></div>
                </div>
                <div class="mini-calendar">
                    <div class="calendar-header">
                        <button class="calendar-nav" id="prevMonth">‚Äπ</button>
                        <div class="calendar-title" id="calendarTitle"></div>
                        <button class="calendar-nav" id="nextMonth">‚Ä∫</button>
                    </div>
                    <div class="calendar-weekdays" id="calendarWeekdays"></div>
                    <div class="calendar-grid" id="calendarGrid"></div>
                </div>
            </div>
            <div class="daily-tasks">
                <h3 id="selectedDateTitle">üìã Today's Tasks</h3>
                <div class="tasks-list" id="dailyTasksList">
                    <div class="no-tasks">Select a date to view tasks</div>
                </div>
            </div>
            <div class="recent-activity">
                <h3>‚ö° Recent Activity</h3>
                <div id="recentIssues"></div>
            </div>
        </div>
    </div>

    <div class="charts-grid">
        <div class="chart-card">
            <h3>üìà Status Distribution</h3>
            <canvas id="statusChart" width="400" height="200"></canvas>
        </div>
        <div class="chart-card">
            <h3>üë• Assignment Status</h3>
            <canvas id="assignmentChart" width="400" height="200"></canvas>
        </div>
    </div>

    <!-- Kanban Board Section -->
    <div class="board-section">
        <h2>üìã Project Board</h2>
        <div class="kanban-board">
            <div class="kanban-column">
                <div class="column-header todo-header">
                    <h3>üìù To Do</h3>
                    <span class="issue-count" id="todoCount">0</span>
                </div>
                <div class="column-content" id="todoColumn">
                    <div class="loading-board">Loading issues...</div>
                </div>
            </div>
            
            <div class="kanban-column">
                <div class="column-header progress-header">
                    <h3>üîÑ In Progress</h3>
                    <span class="issue-count" id="progressCount">0</span>
                </div>
                <div class="column-content" id="progressColumn">
                    <div class="loading-board">Loading issues...</div>
                </div>
            </div>
            
            <div class="kanban-column">
                <div class="column-header done-header">
                    <h3>‚úÖ Done</h3>
                    <span class="issue-count" id="doneCount">0</span>
                </div>
                <div class="column-content" id="doneColumn">
                    <div class="loading-board">Loading issues...</div>
                </div>
            </div>
        </div>
    </div>

    <div class="insights">
        <h2>üí° Project Insights</h2>
        <div id="projectInsights"></div>
    </div>
</div>
</div>

<script>
const API_BASE = 'http://localhost:8000';
let currentProject = 'SCRUM';
let dashboardData = null;
let allIssuesData = [];
let currentCalendarDate = new Date();
let selectedDate = new Date();

// Load projects on page load
document.addEventListener('DOMContentLoaded', function() {
    loadProjects();
    initializeCalendar();
    setupIntersectionObserver();
});

async function loadProjects() {
    try {
        const response = await fetch(`${API_BASE}/api/jira-projects`);
        const data = await response.json();
        
        const select = document.getElementById('projectSelect');
        select.innerHTML = '';
        
        data.values.forEach(project => {
            const option = document.createElement('option');
            option.value = project.key;
            option.textContent = `${project.key} - ${project.name}`;
            select.appendChild(option);
        });
        
        // Set SCRUM as default
        select.value = 'SCRUM';
        currentProject = 'SCRUM';
        
        // Load initial data
        loadData();
        
        // Add change listener
        select.addEventListener('change', function() {
            currentProject = this.value;
            if (currentProject) {
                loadData();
            }
        });
        
    } catch (error) {
        showError('Failed to load projects: ' + error.message);
    }
}

async function loadData() {
    if (!currentProject) return;
    
    document.getElementById('loading').style.display = 'block';
    document.getElementById('dashboard').style.display = 'none';
    document.getElementById('error-container').innerHTML = '';
    
    try {
        const response = await fetch(`${API_BASE}/api/jira/dashboard/${currentProject}`);
        if (!response.ok) {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }
        
        dashboardData = await response.json();
        updateDashboard();
        
        // Load calendar data
        await loadAllIssuesForCalendar();
        
    } catch (error) {
        showError('Failed to load dashboard data: ' + error.message);
    } finally {
        document.getElementById('loading').style.display = 'none';
    }
}

function updateDashboard() {
    if (!dashboardData) return;
    
    const { status_counts, progress_percentage, recent_issues, assignee_distribution } = dashboardData;
    
    // Update stats
    document.getElementById('totalIssues').textContent = status_counts.total || 0;
    document.getElementById('completedIssues').textContent = status_counts.done || 0;
    document.getElementById('progressIssues').textContent = status_counts.in_progress || 0;
    document.getElementById('todoIssues').textContent = status_counts.todo || 0;
    
    // Update progress bar
    const progressPercent = progress_percentage || 0;
    document.getElementById('progressBar').style.width = progressPercent + '%';
    document.getElementById('progressText').textContent = `${progressPercent}% Complete`;
    
    // Update charts
    updateStatusChart(status_counts);
    updateAssignmentChart(assignee_distribution, status_counts.total);
    
    // Update recent activity
    updateRecentActivity(recent_issues);
    
    // Update insights
    updateInsights();
    
    // Update timeline
    updateTimeline();
    
    // Update board
    updateBoard();
    
    document.getElementById('dashboard').style.display = 'block';
}

function updateStatusChart(statusCounts) {
    const canvas = document.getElementById('statusChart');
    if (!canvas) {
        console.error('Status chart canvas not found');
        return;
    }
    
    const ctx = canvas.getContext('2d');
    
    // Destroy existing chart if it exists
    if (window.statusChart && typeof window.statusChart.destroy === 'function') {
        window.statusChart.destroy();
    }
    
    // Set canvas size explicitly
    canvas.style.width = '100%';
    canvas.style.height = '300px';
    
    const data = [
        statusCounts.todo || 0,
        statusCounts.in_progress || 0,
        statusCounts.done || 0
    ];
    
    console.log('Creating status chart with data:', data);
    
    // Only create chart if we have data
    if (data.some(value => value > 0)) {
        const total = data.reduce((a, b) => a + b, 0);
        
        window.statusChart = new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: ['To Do', 'In Progress', 'Done'],
                datasets: [{
                    data: data,
                    backgroundColor: [
                        '#F87171',  // Red for To Do
                        '#FBBF24',  // Yellow for In Progress
                        '#34D399'   // Green for Done
                    ],
                    borderWidth: 3,
                    borderColor: '#ffffff',
                    hoverOffset: 4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            color: '#374151',
                            padding: 20,
                            usePointStyle: true,
                            font: {
                                size: 14
                            }
                        }
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                const percentage = ((context.parsed / total) * 100).toFixed(1);
                                return `${context.label}: ${context.parsed} (${percentage}%)`;
                            }
                        }
                    },
                    datalabels: {
                        display: true,
                        color: '#ffffff',
                        font: {
                            weight: 'bold',
                            size: 14
                        },
                        formatter: function(value, context) {
                            if (value === 0) return '';
                            const percentage = ((value / total) * 100).toFixed(1);
                            return `${percentage}%`;
                        }
                    }
                }
            },
            plugins: [{
                beforeDraw: function(chart) {
                    const ctx = chart.ctx;
                    const data = chart.data.datasets[0].data;
                    const total = data.reduce((a, b) => a + b, 0);
                    
                    chart.data.datasets[0].data.forEach((value, index) => {
                        if (value > 0) {
                            const meta = chart.getDatasetMeta(0);
                            const arc = meta.data[index];
                            const percentage = ((value / total) * 100).toFixed(1);
                            
                            const centerX = arc.x;
                            const centerY = arc.y;
                            
                            ctx.fillStyle = '#374151';
                            ctx.font = 'bold 14px Arial';
                            ctx.textAlign = 'center';
                            ctx.textBaseline = 'middle';
                            
                            const angle = (arc.startAngle + arc.endAngle) / 2;
                            const radius = (arc.innerRadius + arc.outerRadius) / 2;
                            const x = centerX + Math.cos(angle) * radius * 0.8;
                            const y = centerY + Math.sin(angle) * radius * 0.8;
                            
                            ctx.fillText(`${percentage}%`, x, y);
                        }
                    });
                }
            }]
        });
        
        console.log('Status chart created successfully:', window.statusChart);
    } else {
        console.log('No data available for status chart');
        ctx.fillStyle = '#6b7280';
        ctx.font = '16px Arial';
        ctx.textAlign = 'center';
        ctx.fillText('No data available', canvas.width / 2, canvas.height / 2);
    }
}

function updateAssignmentChart(assigneeDistribution, totalIssues) {
    const canvas = document.getElementById('assignmentChart');
    if (!canvas) {
        console.error('Assignment chart canvas not found');
        return;
    }
    
    const ctx = canvas.getContext('2d');
    
    // Destroy existing chart if it exists
    if (window.assignmentChart && typeof window.assignmentChart.destroy === 'function') {
        window.assignmentChart.destroy();
    }
    
    // Set canvas size explicitly
    canvas.style.width = '100%';
    canvas.style.height = '300px';
    
    const assignedCount = Object.values(assigneeDistribution || {}).reduce((a, b) => a + b, 0);
    const unassignedCount = Math.max(0, (totalIssues || 0) - assignedCount);
    
    console.log('Creating assignment chart - Total:', totalIssues, 'Assigned:', assignedCount, 'Unassigned:', unassignedCount);
    
    const data = [assignedCount, unassignedCount];
    
    // Only create chart if we have data
    if (totalIssues > 0) {
        const total = assignedCount + unassignedCount;
        
        window.assignmentChart = new Chart(ctx, {
            type: 'pie',
            data: {
                labels: ['Assigned', 'Unassigned'],
                datasets: [{
                    data: data,
                    backgroundColor: [
                        '#60A5FA',  // Blue for Assigned
                        '#F97316'   // Orange for Unassigned
                    ],
                    borderWidth: 3,
                    borderColor: '#ffffff',
                    hoverOffset: 4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            color: '#374151',
                            padding: 20,
                            usePointStyle: true,
                            font: {
                                size: 14
                            }
                        }
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                const percentage = ((context.parsed / total) * 100).toFixed(1);
                                return `${context.label}: ${context.parsed} (${percentage}%)`;
                            }
                        }
                    }
                }
            },
            plugins: [{
                beforeDraw: function(chart) {
                    const ctx = chart.ctx;
                    const data = chart.data.datasets[0].data;
                    const total = data.reduce((a, b) => a + b, 0);
                    
                    chart.data.datasets[0].data.forEach((value, index) => {
                        if (value > 0) {
                            const meta = chart.getDatasetMeta(0);
                            const arc = meta.data[index];
                            const percentage = ((value / total) * 100).toFixed(1);
                            
                            const centerX = arc.x;
                            const centerY = arc.y;
                            
                            ctx.fillStyle = '#374151';
                            ctx.font = 'bold 14px Arial';
                            ctx.textAlign = 'center';
                            ctx.textBaseline = 'middle';
                            
                            const angle = (arc.startAngle + arc.endAngle) / 2;
                            const radius = (arc.innerRadius + arc.outerRadius) / 2;
                            const x = centerX + Math.cos(angle) * radius * 0.8;
                            const y = centerY + Math.sin(angle) * radius * 0.8;
                            
                            ctx.fillText(`${percentage}%`, x, y);
                        }
                    });
                }
            }]
        });
        
        console.log('Assignment chart created successfully:', window.assignmentChart);
    } else {
        console.log('No data available for assignment chart');
        ctx.fillStyle = '#6b7280';
        ctx.font = '16px Arial';
        ctx.textAlign = 'center';
        ctx.fillText('No data available', canvas.width / 2, canvas.height / 2);
    }
}

function updateRecentActivity(recent_issues) {
    const container = document.getElementById('recentIssues');

    if (!recent_issues || recent_issues.length === 0) {
        container.innerHTML = '<div class="no-tasks">No recent activity</div>';
        return;
    }

    container.innerHTML = recent_issues.slice(0, 15).map(issue => {
        // Handle both object and string formats for assignee and status
        const assigneeName = (issue.assignee && issue.assignee.name) ? issue.assignee.name : (issue.assignee || 'Unassigned');
        const statusName = (issue.status && issue.status.name) ? issue.status.name : (issue.status || 'Unknown');

        return `
            <div class="activity-item">
                <div class="activity-header">
                    <a href="#" class="issue-key-link">${issue.key}</a>
                    <span class="status-badge ${getStatusClass(statusName)}">${statusName}</span>
                </div>
                <p class="activity-summary">${issue.summary}</p>
                <div class="activity-meta">
                    <span>${assigneeName}</span>
                    <span>‚Ä¢</span>
                    <span>Updated ${new Date(issue.updated).toLocaleDateString()}</span>
                </div>
            </div>
        `;
    }).join('');
}

function updateInsights() {
    const container = document.getElementById('projectInsights');
    const { status_counts, assignee_distribution, progress_percentage } = dashboardData;
    
    const totalIssues = status_counts.total || 0;
    const assignedCount = Object.values(assignee_distribution || {}).reduce((a, b) => a + b, 0);
    const unassignedCount = totalIssues - assignedCount;
    
    let insights = [];
    
    // Progress insight
    if (progress_percentage < 5) {
        insights.push({
            type: 'info',
            title: 'üöÄ Project Getting Started',
            message: `Your project is in early stages with ${progress_percentage}% completion. Focus on breaking down large tasks and getting initial features working.`
        });
    }
    
    // Assignment insight
    if (unassignedCount > totalIssues * 0.5) {
        insights.push({
            type: 'warning',
            title: '‚ö†Ô∏è Many Unassigned Issues',
            message: `${unassignedCount} out of ${totalIssues} issues are unassigned. Consider assigning these to team members to improve project velocity.`
        });
    }
    
    // Team insight
    const teamSize = Object.keys(assignee_distribution || {}).length;
    if (teamSize === 1) {
        insights.push({
            type: 'info',
            title: 'üë§ Solo Project',
            message: 'This appears to be a solo project. Consider breaking down large tasks into smaller, manageable pieces.'
        });
    }
    
    // Success insight
    if (status_counts.done > 0) {
        insights.push({
            type: 'success',
            title: '‚úÖ Making Progress',
            message: `Great work! You've completed ${status_counts.done} issues. Keep up the momentum!`
        });
    }
    
    container.innerHTML = insights.map(insight => `
        <div class="insight-item insight-${insight.type}">
            <h4>${insight.title}</h4>
            <p>${insight.message}</p>
        </div>
    `).join('');
}

function updateTimeline() {
    const { status_counts, progress_percentage } = dashboardData;
    
    // Updated timeline logic for UNCIA-specific workflow
    let currentStep = 1;
    let stepText = "Take Over";
    
    if (progress_percentage > 0) {
        currentStep = 2;
        stepText = "Day 0";
    }
    
    if (status_counts.done > 0 && status_counts.done >= status_counts.total * 0.1) {
        currentStep = 3;
        stepText = "GO LIVE INTIATION";
    }
    
    if (status_counts.done >= status_counts.total * 0.25) {
        currentStep = 4;
        stepText = "Readiness for Day !";
    }
    
    if (status_counts.done >= status_counts.total * 0.4) {
        currentStep = 5;
        stepText = "Solution Design";
    }
    
    if (status_counts.done >= status_counts.total * 0.6) {
        currentStep = 6;
        stepText = "Reports";
    }
    
    if (status_counts.done >= status_counts.total * 0.8) {
        currentStep = 7;
        stepText = "Readiness for Go Live";
    }
    
    if (status_counts.done === status_counts.total) {
        currentStep = 8;
        stepText = "GO LIVE";
    }
    
    // Update timeline visual state
    const steps = document.querySelectorAll('.timeline-step');
    const connectors = document.querySelectorAll('.timeline-connector');
    
    steps.forEach((step, index) => {
        const stepNumber = index + 1;
        step.classList.remove('completed', 'current');
        
        if (stepNumber < currentStep) {
            step.classList.add('completed');
        } else if (stepNumber === currentStep) {
            step.classList.add('current');
        }
    });
    
    connectors.forEach((connector, index) => {
        connector.classList.remove('completed');
        if (index + 1 < currentStep) {
            connector.classList.add('completed');
        }
    });
    
    // Update progress text
    document.getElementById('timelineProgressText').textContent = 
        `Step ${currentStep} of 8 - ${stepText}`;
}

async function updateBoard() {
    if (!currentProject) return;
    
    try {
        const response = await fetch(`${API_BASE}/api/jira/board/${currentProject}`);
        if (!response.ok) {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }
        
        const boardData = await response.json();
        renderBoard(boardData);
        
    } catch (error) {
        console.error('Failed to load board data:', error);
        showBoardError('Failed to load board data: ' + error.message);
    }
}

function renderBoard(boardData) {
    const { board, counts } = boardData;
    
    // Update counts
    document.getElementById('todoCount').textContent = counts.todo || 0;
    document.getElementById('progressCount').textContent = counts.in_progress || 0;
    document.getElementById('doneCount').textContent = counts.done || 0;
    
    // Render columns
    renderBoardColumn('todoColumn', board.todo || [], 'No tasks to do');
    renderBoardColumn('progressColumn', board.in_progress || [], 'No tasks in progress');
    renderBoardColumn('doneColumn', board.done || [], 'No completed tasks');
}

function renderBoardColumn(columnId, issues, emptyMessage) {
    const column = document.getElementById(columnId);
    
    if (!issues || issues.length === 0) {
        column.innerHTML = `<div class="no-issues">${emptyMessage}</div>`;
        return;
    }
    
    column.innerHTML = issues.map(issue => `
        <div class="issue-card" onclick="openIssueDetails('${issue.key}')">
            <div class="issue-key">${issue.key}</div>
            <div class="issue-summary">${issue.summary || 'No summary'}</div>
            <div class="issue-meta">
                <span class="issue-assignee">${issue.assignee && issue.assignee.name ? issue.assignee.name : 'Unassigned'}</span>
                <span class="issue-type">${issue.issuetype || 'Task'}</span>
                ${issue.duedate ? `<span class="issue-due-date">Due: ${new Date(issue.duedate).toLocaleDateString()}</span>` : ''}
            </div>
        </div>
    `).join('');
}

function getPriorityDot(priority) {
    if (!priority) return '';
    
    const priorityClass = getPriorityClass(priority);
    return `<span class="issue-priority ${priorityClass}" title="${priority}"></span>`;
}

function getPriorityClass(priority) {
    switch(priority) {
        case 'highest': return 'priority-highest';
        case 'high': return 'priority-high';
        case 'medium': return 'priority-medium';
        case 'low': return 'priority-low';
        case 'lowest': return 'priority-lowest';
        default: return 'priority-medium';
    }
}

function openIssueDetails(issueKey) {
    // Open issue in new tab (you can customize this)
    const jiraUrl = `https://uncia-team-vmevzjmu.atlassian.net/browse/${issueKey}`;
    window.open(jiraUrl, '_blank');
}

function showBoardError(message) {
    const columns = ['todoColumn', 'progressColumn', 'doneColumn'];
    columns.forEach(columnId => {
        const column = document.getElementById(columnId);
        column.innerHTML = `<div class="no-issues">Error: ${message}</div>`;
    });
}

function getStatusClass(status) {
    const statusLower = status.toLowerCase();
    if (statusLower.includes('done') || statusLower.includes('complete')) {
        return 'status-done';
    } else if (statusLower.includes('progress')) {
        return 'status-progress';
    } else {
        return 'status-todo';
    }
}

function showError(message) {
    const container = document.getElementById('error-container');
    container.innerHTML = `
        <div class="error">
            <strong>Error:</strong> ${message}
            <br><small>Make sure your Flask app is running on http://localhost:8000</small>
        </div>
    `;
}

// Calendar Functions
function initializeCalendar() {
    updateCalendarDisplay();
    
    document.getElementById('prevMonth').addEventListener('click', () => {
        currentCalendarDate.setMonth(currentCalendarDate.getMonth() - 1);
        updateCalendarDisplay();
    });
    
    document.getElementById('nextMonth').addEventListener('click', () => {
        currentCalendarDate.setMonth(currentCalendarDate.getMonth() + 1);
        updateCalendarDisplay();
    });
    
    // Set today as selected by default
    selectedDate = new Date();
    updateSelectedDateDisplay(selectedDate);
    updateDailyTasks();
}

function updateSelectedDateDisplay(date) {
    const monthNames = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
    const dayNames = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];

    document.getElementById('selectedDateMonth').textContent = monthNames[date.getMonth()];
    document.getElementById('selectedDateWeekday').textContent = dayNames[date.getDay()];
    
    const numberEl = document.getElementById('selectedDateNumber');
    numberEl.textContent = date.getDate();
    
    // Trigger pop-in animation
    numberEl.classList.remove('pop-in');
    void numberEl.offsetWidth; // This is a trick to force a DOM reflow, allowing the animation to re-trigger
    numberEl.classList.add('pop-in');
}

function updateCalendarDisplay() {
    const monthNames = ["January", "February", "March", "April", "May", "June",
        "July", "August", "September", "October", "November", "December"];
    
    const year = currentCalendarDate.getFullYear();
    const month = currentCalendarDate.getMonth();
    
    document.getElementById('calendarTitle').textContent = `${monthNames[month]} ${year}`;

    const weekdaysContainer = document.getElementById('calendarWeekdays');
    weekdaysContainer.innerHTML = ''; // Clear existing
    const weekdays = ['S', 'M', 'T', 'W', 'T', 'F', 'S']; // Single letters
    weekdays.forEach(day => {
        const weekdayElement = document.createElement('div');
        weekdayElement.className = 'calendar-weekday';
        weekdayElement.textContent = day;
        weekdaysContainer.appendChild(weekdayElement);
    });
    
    const calendarGrid = document.getElementById('calendarGrid');
    calendarGrid.innerHTML = '';
    
    // Get first day of month and number of days
    const firstDay = new Date(year, month, 1);
    const lastDay = new Date(year, month + 1, 0);
    const daysInMonth = lastDay.getDate();
    const startingDay = firstDay.getDay();
    
    // Add previous month's days
    const prevMonth = new Date(year, month - 1, 0);
    for (let i = startingDay - 1; i >= 0; i--) {
        const day = prevMonth.getDate() - i;
        const dayElement = createCalendarDay(day, true, new Date(year, month - 1, day));
        calendarGrid.appendChild(dayElement);
    }
    
    // Add current month's days
    for (let day = 1; day <= daysInMonth; day++) {
        const dayElement = createCalendarDay(day, false, new Date(year, month, day));
        calendarGrid.appendChild(dayElement);
    }
    
    // Add next month's days to fill grid
    const totalCells = calendarGrid.children.length;
    const remainingCells = 42 - totalCells; // 6 rows √ó 7 days
    for (let day = 1; day <= remainingCells; day++) {
        const dayElement = createCalendarDay(day, true, new Date(year, month + 1, day));
        calendarGrid.appendChild(dayElement);
    }
}

function createCalendarDay(day, isOtherMonth, date) {
    const dayElement = document.createElement('div');
    dayElement.className = 'calendar-day';
    dayElement.textContent = day;
    
    if (isOtherMonth) {
        dayElement.classList.add('other-month');
    }
    
    // Check if it's today
    const today = new Date();
    if (date.toDateString() === today.toDateString()) {
        dayElement.classList.add('today');
    }
    
    // Check if it's selected date
    if (date.toDateString() === selectedDate.toDateString()) {
        dayElement.classList.add('selected');
    }
    
    // Check if this date has tasks (either due or created)
    const tasksOnDate = getTasksForDate(date);
    if (tasksOnDate.length > 0) {
        dayElement.classList.add('has-tasks');
        const indicator = document.createElement('div');
        indicator.className = 'task-indicator';
        dayElement.appendChild(indicator);
    }
    
    // Add click event
    dayElement.addEventListener('click', () => {
        // Remove previous selection
        document.querySelectorAll('.calendar-day.selected').forEach(el => {
            el.classList.remove('selected');
        });
        
        // Add selection to clicked day
        dayElement.classList.add('selected');
        selectedDate = new Date(date);
        updateSelectedDateDisplay(selectedDate);
        updateDailyTasks();
    });
    
    return dayElement;
}

function getTasksForDate(date) {
    if (!allIssuesData || allIssuesData.length === 0) {
        console.log('No issues data available');
        return [];
    }
    
    const dateString = date.toDateString();
    console.log('Looking for tasks on:', dateString);
    
    return allIssuesData.filter(issue => {
        // First try duedate, then fall back to created date for demonstration
        let taskDate = null;
        
        if (issue.duedate) {
            taskDate = new Date(issue.duedate);
        } else if (issue.created) {
            // Use created date for demonstration purposes
            taskDate = new Date(issue.created);
        }
        
        if (taskDate) {
            console.log('Comparing:', taskDate.toDateString(), 'vs', dateString);
            return taskDate.toDateString() === dateString;
        }
        return false;
    });
}

function updateDailyTasks() {
    const tasksOnDate = getTasksForDate(selectedDate);
    const titleElement = document.getElementById('selectedDateTitle');
    const tasksListElement = document.getElementById('dailyTasksList');
    
    const dateStr = selectedDate.toLocaleDateString('en-US', { 
        weekday: 'long', 
        year: 'numeric', 
        month: 'long', 
        day: 'numeric' 
    });
    
    titleElement.innerHTML = `üìã Tasks for ${dateStr}`;
    
    if (tasksOnDate.length === 0) {
        tasksListElement.innerHTML = '<div class="no-tasks">No tasks due or created on this date</div>';
        return;
    }
    
    tasksListElement.innerHTML = tasksOnDate.map(task => {
        // Show if it's due date or created date
        const dateType = task.duedate ? 'Due' : 'Created';
        const taskDate = task.duedate || task.created;
        return `
            <div class="task-item" onclick="openIssueDetails('${task.key}')">
                <div class="task-key">${task.key} <small style="color: #888;">(${dateType})</small></div>
                <div class="task-summary">${task.summary || 'No summary'}</div>
                <div class="task-meta">
                    <span class="task-assignee">${task.assignee && task.assignee.name ? task.assignee.name : 'Unassigned'}</span>
                    <span class="task-start-date">Start: ${task.created ? new Date(task.created).toLocaleDateString() : 'N/A'}</span>
                    <div>
                        <span>${task.issuetype && task.issuetype.name ? task.issuetype.name : 'Task'}</span>
                        ${task.priority && task.priority.name ? `<span class="task-priority ${getPriorityClass(task.priority.name.toLowerCase())}" title="${task.priority.name}"></span>` : ''}
                    </div>
                </div>
            </div>
        `;
    }).join('');
}

async function loadAllIssuesForCalendar() {
    if (!currentProject) return;
    
    try {
        const response = await fetch(`${API_BASE}/api/jira/issues/${currentProject}`);
        if (!response.ok) {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }
        
        const issuesData = await response.json();
        allIssuesData = issuesData.issues || [];
        
        // Update calendar to show tasks
        updateCalendarDisplay();
        updateDailyTasks();
        
    } catch (error) {
        console.error('Failed to load issues for calendar:', error);
    }
}

function setupIntersectionObserver() {
    const options = {
        root: null,
        rootMargin: '0px',
        threshold: 0.3
    };

    const observer = new IntersectionObserver((entries, observer) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.classList.add('in-view');
                observer.unobserve(entry.target);
            }
        });
    }, options);

    const timeline = document.querySelector('.timeline-section');
    if (timeline) {
        observer.observe(timeline);
    }
}
</script>
</body>
</html>